<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Exercises/threat-profile">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-156693847-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156693847-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-156693847-1",{})</script>



<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-rh="true">Decomposing a Threat | Red Team Development and Operations</title><meta data-rh="true" property="og:url" content="https://redteam.guide/redteamguide/docs/Exercises/threat-profile"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:title" content="Red Team Development and Operations"><meta data-rh="true" name="twitter:description" content="A practical guide - by Joe Vest and James Tubberville"><meta data-rh="true" name="twitter:image" content="https://redteam.guide/img/books.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Decomposing a Threat | Red Team Development and Operations"><meta data-rh="true" name="description" content="Exercise: Decomposing a Threat in to a Threat Profile
"><meta data-rh="true" property="og:description" content="Exercise: Decomposing a Threat in to a Threat Profile
"><link data-rh="true" rel="icon" href="/redteamguide/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://redteam.guide/redteamguide/docs/Exercises/threat-profile"><link data-rh="true" rel="alternate" href="https://redteam.guide/redteamguide/docs/Exercises/threat-profile" hreflang="en"><link data-rh="true" rel="alternate" href="https://redteam.guide/redteamguide/docs/Exercises/threat-profile" hreflang="x-default"><link rel="stylesheet" href="/redteamguide/assets/css/styles.d4a85786.css">
<link rel="preload" href="/redteamguide/assets/js/runtime~main.bc114d3a.js" as="script">
<link rel="preload" href="/redteamguide/assets/js/main.2235c1b7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/redteamguide/"><div class="navbar__logo"><img src="/redteamguide/img/logo.png" alt="REDTEAM.GUIDE" class="themedImage_ToTc themedImage--light_HNdA"><img src="/redteamguide/img/logo.png" alt="REDTEAM.GUIDE" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">REDTEAM.GUIDE</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/redteamguide/docs/guides">Red Teaming Guides</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/redteamguide/docs/about_the_book">About the book</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/redteamguide/docs/about_the_authors">About the Authors</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/redteamguide/docs/definitions">Red Teaming Definitions</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/threatexpress" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github"></a><a href="https://threatexpress.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/redteamguide/docs/about_the_authors">About the Authors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/redteamguide/docs/about_the_book">About the Book</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/redteamguide/docs/definitions">Definitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/redteamguide/docs/guides">Red Team Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/redteamguide/docs/references_templates_talks">References, Templates, and Presentations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redteamguide/docs/checklists/red-team-checklist">Checklists and Planning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redteamguide/docs/Concepts/mitre_attack">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redteamguide/docs/Planning/goal-planning">Planning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redteamguide/docs/Templates/oplog">Templates</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redteamguide/docs/Threat Profiles/autobank">Threat Profiles</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/redteamguide/docs/Exercises/mindset-challege">Exercises</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/redteamguide/docs/Exercises/mindset-challege">Adversarial Mindset Challenge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/redteamguide/docs/Exercises/threat-profile">Decomposing a Threat</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/redteamguide/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Exercises</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Decomposing a Threat</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Decomposing a Threat</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description<a class="hash-link" href="#description" title="Direct link to heading">​</a></h2><p>This is a group exercise. As a class, we will examine the Energetic Bear threat actor to build a threat profile that can be used during a Red Team engagement</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objectives">Objectives<a class="hash-link" href="#objectives" title="Direct link to heading">​</a></h2><ul><li>Review the Energetic Bear threat actor’s TTPs.</li><li>Use the information to create a threat that is similar and can be used to support future Red Team engagements.</li><li>Complete a threat profile</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="instructions">Instructions<a class="hash-link" href="#instructions" title="Direct link to heading">​</a></h2><ul><li>Use the Energetic Bear material provided for reference.</li><li>Modify and adjust the profile to fit your scenario.</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This is one of the more difficult exercises to complete. It is not technically difficult, but dives into threat emulation design that many have not explored. There is no right or wrong answer. The exploration and process of decomposing a threat is the most valuable aspect of the exercise. Practice is the best way to understand this process.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scenario">Scenario<a class="hash-link" href="#scenario" title="Direct link to heading">​</a></h2><p>A client has asked your Red Team to emulate a specific threat. Specifically they are interested in the attacks by Energetic Bear.</p><p><strong>Goal</strong></p><p>As professional Red Team, you understand that emulating a specific threat actor is not easy or feasible. Instead of redesigning Energetic Bear, you understand focus should be on the emulation of a threat’s TTPs. This is more valuable that emulating a specific threat actor. The goal is not document the Energetic Bear threat actor but to create a threat profile document using Energetic Bear as inspiration. You will use research on Energetic Bear&#x27;s TTPs to build out a custom threat profile that is technically feasible and can be used to engage the target with realistic threat TTPs. A complete threat profile will contain details that can be used to plan and design the execution of a threat against a target. These are typically deployed as a command and control channel. We will discuss command and control in more detail later. </p><p>Use Energetic Bear references, MITRE, ATT&amp;CK, personal experience, and intuition to develop the profile. Remember, this is your interpretation of a threat using a specific threat actor as inspiration.</p><p><strong>Resources</strong></p><ul><li><a href="https://attack.mitre.org/wiki/Main_Page" target="_blank" rel="noopener noreferrer">MITRE ATT&amp;CK Framework</a>, <a href="https://attack.mitre.org/wiki/Main_Page" target="_blank" rel="noopener noreferrer">https://attack.mitre.org/wiki/Main_Page</a></li><li><a href="https://attack.mitre.org/wiki/ATT%26CK_Navigator" target="_blank" rel="noopener noreferrer">MITRE ATT&amp;CK Navigator</a>, <a href="https://attack.mitre.org/wiki/ATT%26CK_Navigator" target="_blank" rel="noopener noreferrer">https://attack.mitre.org/wiki/ATT%26CK_Navigator</a></li><li><a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">Dragonfly: Cyberespionage Attacks Against Energy Suppliers</a>, <a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf</a></li><li><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">Energetic Bear – Crouching Yeti</a>, <a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf</a></li><li><a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">The Alley of Compromise</a>, <a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="threat-profile-example">Threat Profile Example<a class="hash-link" href="#threat-profile-example" title="Direct link to heading">​</a></h3><table><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>Description</td><td>General mid-tiered threat that uses common offensive tools and techniques.</td></tr><tr><td>Goal and Intent</td><td>Exist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks.</td></tr><tr><td>Key IOCs</td><td>Cobalt Strike HTTPS beacon on TCP 443, Payload: c:\programdata\microsoft\iexplore.exe, Timestamp: 7/13/2009 10:04 PM, MD5: a7705501c5e216b56cf49dcf540184d0</td></tr><tr><td>C2 Overview</td><td>HTTPS on port 443 Cobalt Strike Beacon with a five-minute callback time. Calling directly to threat-owned domains.</td></tr><tr><td>TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)</td><td>Assumed Breach Model, no initial delivery via exploitation. POST-exploitation via Cobalt Strike commands. Enumeration and lateral movement via Cobalt Strike and native Windows commands. Privilege escalation limited and determined POST-exploitation.</td></tr><tr><td>Exploitation</td><td>Assumed Breach Model, no exploitation.</td></tr><tr><td>Persistence</td><td>User-level persistence using Microsoft Outlook rule triggered by specific email.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="threat-profile-usage">Threat Profile Usage<a class="hash-link" href="#threat-profile-usage" title="Direct link to heading">​</a></h3><p>Threat profiles typically support the engagement story and are used to describe the technical aspects of a single C2 channel. A single threat profile is used for each C2 channel.</p><p><img loading="lazy" src="/redteamguide/assets/images/threatprofilediagram-34a718ef9d484fc26d523b509f119bd0.png" width="799" height="439" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="highlights-from-energetic-bear-threat-actor">Highlights from Energetic Bear Threat Actor<a class="hash-link" href="#highlights-from-energetic-bear-threat-actor" title="Direct link to heading">​</a></h3><ul><li>Starting in 2010 and ending in 2014, Energetic Bear / Dragonfly / Crouching Yeti malware attacked numerous computers to collect information on industrial control systems in the United States and Europe</li><li>Spread out over time and thus difficult to detect</li><li>The primary goal was to collect information that impacted the energy and pharmaceutical industries</li><li>Possibly nation-state supported</li><li>Phishing, watering hole attacks</li><li>Known exploits were used (PDF, Java, IE, Word)</li><li>Compromised ICS web servers</li><li>HTTP-based C2</li><li>Specific activities and capabilities</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iocs-from-the-actor-energetic-bear-and-the-havex-malware">IOCs from the actor Energetic Bear and the HAVEX malware<a class="hash-link" href="#iocs-from-the-actor-energetic-bear-and-the-havex-malware" title="Direct link to heading">​</a></h3><p><img loading="lazy" src="/redteamguide/assets/images/threatprofile_0-c076648a9d54cbfc77ee6b3a848fd422.png" width="600" height="244" class="img_ev3q"></p><p><strong>Actor</strong></p><ul><li>Associated with the Russian Federation</li><li>Active over multiple years</li><li>Active primarily during Moscow business hours</li><li>Targeted organizations based in the industry control system sector</li><li>Goal of gathering intelligence on ICS-based organizations</li><li>Use of custom malware</li></ul><p><strong>Attack and delivery TTPs</strong></p><ul><li>Phishing</li><li>Watering hole</li><li>Compromised web servers</li></ul><p><strong>Exploitation TTPs</strong></p><ul><li>PDF exploits</li><li>Java and IE exploits</li><li>Word exploits</li><li>Custom binaries</li></ul><p><strong>Post-exploitation TTPs</strong></p><ul><li>Local system enumeration for OS, username, processes, internet history, etc.</li><li>Scan for known ICS-related ports</li><li>DLL injection to migrate into explorer.exe</li><li>Collect Outlook address book information</li><li>Collect passwords from browsers</li><li>Save exfiltrated data to an encrypted file on disk before delivery to the C2 in an HTTP POST request</li></ul><p><strong>Persistence TTPs</strong></p><p>Run key registry modifications:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#ffffff;--prism-background-color:#033b3f"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\&quot;TmProvider&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\&quot;TmProvider&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_LOCAL_MACHINE\ SOFTWARE\Microsoft\Internet Explorer\InternetRegistry\&quot;fertger&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\InternetRegistry</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>HAVEX Paylod Delivery</strong></p><p><img loading="lazy" src="/redteamguide/assets/images/threatprofile_1-167417e8911b9d986bc96005e9cfe0a2.png" width="572" height="149" class="img_ev3q"></p><p>Energetic Bear used three major methods to deliver malware.</p><p><strong>1) Malicious PDF via spear-phishing</strong>
Spear-phishing was used to infect targeted individuals for initial information gathering by delivering malicious PDF documents—in this case, PDF/SWF exploits targeting CVE-2011-0611 to drop malware.3 Even with this running through 2014, older exploits were still valuable.</p><p><strong>2) Malicious JAR and HTML via a watering hole attack</strong>
Watering hole attacks were used to deliver Backdoor.Oldrea by Symantec. These attacks exploited CVE-2013-2465, CVE-2013-1347, and CVE-2012-1723 in Java 6, Java 7, IE 7, and IE 8 to drop the HAVEX malware. The exploits appeared to be modified Metasploit Java exploits built to deliver the HAVEX loader.</p><p><strong>3) Legitimate software loaders</strong>
Energetic Bear compromised several legitimate ICS vendor websites. Binaries such as camera drivers and PLC management software were modified and made to deliver the HAVEX malware.</p><p>In order to complete the third attack type, the threat actor had to compromise several ICS vendors&#x27; websites. Sometimes called a Strategic Web Compromise (SWC) attack, these have become a favorite attack method from Russian- and Chinese-based threats. In this case, SWC attacks were used to compromise a site that would most likely be visited by customers or users of ICS systems. This made the watering hole or binary compromises much more useful against the targeted victim. Using these three attack types demonstrated an organized and arguably sophisticated threat actor. The team behind this planned and organized a scenario to be successful against its target audience.</p><p>Once malware was delivered, three major tasks were observed:</p><ul><li>System enumeration tools collected information, such as the OS version, machine name and username, and file and directory listings.</li><li>A credential-harvesting tool extracted stored passwords from various web browsers.</li><li>Secondary implants6 communicated with different C2 infrastructures using custom protocols and payloads executed in memory.</li></ul><p><strong>References</strong></p><ul><li><a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">Dragonfly: Cyberespionage Attacks Against Energy Suppliers</a>, <a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf</a></li><li><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">Energetic Bear - Crouching Yeti</a>, <a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf</a></li><li>[The Alley of Compromise]<!-- -->(<a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise</a>, <a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise</a>)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="havex-http-request-sample">HAVEX HTTP Request Sample<a class="hash-link" href="#havex-http-request-sample" title="Direct link to heading">​</a></h3><p><strong>POST Request</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#ffffff;--prism-background-color:#033b3f"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">POST /wp08/wp-includes/dtcla.php?id=285745296322896178920098FD80-20&amp;v1=038&amp;v2=170393861&amp;q=5265882854508EFCF958F979E4 HTTP/1.1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/525.19(KHTML, like Gecko) Chrome/1.0.154.36 Safari/525.19</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Host: toons.freesexycomics.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Content-Length: 0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-cache</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>POST Response</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#ffffff;--prism-background-color:#033b3f"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Date: Wed, 22 Jan 2014 13:40:48 GMT</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Content-Type: text/html</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Transfer-Encoding: chunked</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Server: Apache/1.3.37 (Unix)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-cache</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">9f65</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">&lt;html&gt;&lt;head&gt;&lt;mega http-equiv=’CACHE-CONTROL’ content=’NO-CACHE’&gt;&lt;/head&gt;&lt;body&gt;No data!&lt;!--havexQlpoOTFBWSZTWWYvDI0BOsD/////////////////////////////////////////////4oB+93VVXu69DuN7XYzds9yt49Ques</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">[...TRUNCATED ...]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+yUW3zfTxWAOstsCwCckdW5 AH5Q6vbbCu7GputPt5CSfgPCAKXcAOOICMsqliACGYEhAQT3v9eD</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">M92D/8XckU4UJBmLwyNA==havex--&gt;&lt;/body&gt;&lt;/head&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example from Symantec, several indicators can be identified.</p><p>The POST request shows several indicators that may be incorporated into an emulated threat:</p><ul><li>A target PHP file (dtcla.php)</li><li>Interesting URL parameters (id, v1, v2, q)</li><li>A potentially interesting User-Agent</li><li>A target host</li></ul><p>Like the request, the response has several indicators:</p><ul><li>A server header</li><li>A potentially unique ID (9f65)</li><li>Base64-encoded data stored between text (havex &lt; base64 &gt; havex)</li></ul><p>Note: MALWAREMUSTDIE2 posted a great write-up on the HAVEX malware. This provides additional examples of C2 source code and HTTP request/response pairs.</p><p>References</p><ol><li><a href="http://pastebin.com/qCdMwtZ6" target="_blank" rel="noopener noreferrer">MALWAREMUSTDIE</a>, <a href="http://pastebin.com/qCdMwtZ6" target="_blank" rel="noopener noreferrer">http://pastebin.com/qCdMwtZ6</a></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="threat-profile-template">Threat Profile Template<a class="hash-link" href="#threat-profile-template" title="Direct link to heading">​</a></h3><table><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>Description</td><td></td></tr><tr><td>Goal and Intent</td><td></td></tr><tr><td>Key IOCs</td><td></td></tr><tr><td>C2 Overview</td><td></td></tr><tr><td>TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)</td><td></td></tr><tr><td>Exploitation</td><td></td></tr><tr><td>Persistence</td><td></td></tr></tbody></table><hr><p><strong>!! Stop Here !!</strong></p><p>Do not continue until ready for a possible solution.</p><br><br><br><br><br><br><br><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="possible-solution">Possible Solution<a class="hash-link" href="#possible-solution" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="threat-profile-example-1">Threat Profile Example<a class="hash-link" href="#threat-profile-example-1" title="Direct link to heading">​</a></h3><table><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>Description</td><td>General mid-tiered threat that uses common offensive tools and techniques.</td></tr><tr><td>Goal and Intent</td><td>Exist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks.</td></tr><tr><td>Key IOCs</td><td>PowerShell Empire HTTP agent on TCP 80, Location: Memory Resident and PowerShell Script stored in Registry, HTTP matching HAVEX</td></tr><tr><td>C2 Overview</td><td>HTTPS on port 80 with a 5 second callback. Calling directly to threat-owned domains.</td></tr><tr><td>TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)</td><td>Initially delivered during exploitation.  POST exploitation delivery via PowerShell commands.  Enumeration and lateral movement via PS Empire and native Windows commands.  Privilege escalation limited and determined POST exploitation.</td></tr><tr><td>Exploitation</td><td>Social Engineering via Phishing, watering hole, and supply chain via compromised web servers</td></tr><tr><td>Persistence</td><td>Persistence via registry RUN key modification</td></tr></tbody></table><p><strong>HAVEX HTTP Indicators</strong></p><p>Parameters:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#ffffff;--prism-background-color:#033b3f"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">v1=038&amp;v2=170393861&amp;q=5265…</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Headers:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#ffffff;--prism-background-color:#033b3f"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">&lt;head&gt;&lt;mega http-equiv=&#x27;CACHE-CONTROL&#x27; content=&#x27;NO CACHE&#x27;&gt;&lt;/head&gt;&lt;body&gt;No Data!&lt;!--havexhavex--&gt;&lt;/body&gt;&lt;/head&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>In this exercise, you examined the Energetic Bear threat actor in order to design what a threat profile can be.</p><ul><li>You learned which IOCs are exposed when tools are kept to their default settings.</li><li>You learned that the testing of tools before use is critical in understanding a tool’s IOC profile.</li><li>You changed the default IOCs of common security tools.</li><li>You learned that some tools are easier than others to modify.</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/redteamguide/docs/Exercises/mindset-challege"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Adversarial Mindset Challenge</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link toc-highlight">Description</a></li><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives</a></li><li><a href="#instructions" class="table-of-contents__link toc-highlight">Instructions</a></li><li><a href="#scenario" class="table-of-contents__link toc-highlight">Scenario</a><ul><li><a href="#threat-profile-example" class="table-of-contents__link toc-highlight">Threat Profile Example</a></li><li><a href="#threat-profile-usage" class="table-of-contents__link toc-highlight">Threat Profile Usage</a></li><li><a href="#highlights-from-energetic-bear-threat-actor" class="table-of-contents__link toc-highlight">Highlights from Energetic Bear Threat Actor</a></li><li><a href="#iocs-from-the-actor-energetic-bear-and-the-havex-malware" class="table-of-contents__link toc-highlight">IOCs from the actor Energetic Bear and the HAVEX malware</a></li><li><a href="#havex-http-request-sample" class="table-of-contents__link toc-highlight">HAVEX HTTP Request Sample</a></li><li><a href="#threat-profile-template" class="table-of-contents__link toc-highlight">Threat Profile Template</a></li></ul></li><li><a href="#possible-solution" class="table-of-contents__link toc-highlight">Possible Solution</a><ul><li><a href="#threat-profile-example-1" class="table-of-contents__link toc-highlight">Threat Profile Example</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/redteamguide/docs/guides">Red Team Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/redteamguide/docs/about_the_book">About the Book</a></li><li class="footer__item"><a class="footer__link-item" href="/redteamguide/docs/about_the_authors">About the Authors</a></li><li class="footer__item"><a class="footer__link-item" href="/redteamguide/docs/definitions">Red Teaming Definitions</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/joevest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter - Joe Vest<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/minis_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter - James Tubberville<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://threatexpress.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/threatexpress" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 RedTeam.Guide</div></div></div></footer></div>
<script src="/redteamguide/assets/js/runtime~main.bc114d3a.js"></script>
<script src="/redteamguide/assets/js/main.2235c1b7.js"></script>
</body>
</html>