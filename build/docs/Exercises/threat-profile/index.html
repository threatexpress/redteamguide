<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-156693847-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-react-helmet="true">Decomposing a Threat | Red Team Development and Operations</title><meta data-react-helmet="true" property="og:url" content="https://redteam.guide/docs/Exercises/threat-profile"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="twitter:title" content="Red Team Development and Operations"><meta data-react-helmet="true" name="twitter:description" content="A practical guide - by Joe Vest and James Tubberville"><meta data-react-helmet="true" name="twitter:image" content="https://redteam.guide/img/books.png"><meta data-react-helmet="true" property="og:title" content="Decomposing a Threat | Red Team Development and Operations"><meta data-react-helmet="true" name="description" content="Exercise: Decomposing a Threat in to a Threat Profile
"><meta data-react-helmet="true" property="og:description" content="Exercise: Decomposing a Threat in to a Threat Profile
"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://redteam.guide/docs/Exercises/threat-profile"><link data-react-helmet="true" rel="alternate" href="https://redteam.guide/docs/Exercises/threat-profile" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://redteam.guide/docs/Exercises/threat-profile" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de058d6d.css">
<link rel="preload" href="/assets/js/runtime~main.a40e027e.js" as="script">
<link rel="preload" href="/assets/js/main.b4d48a07.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ shadow--md">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="REDTEAM.GUIDE" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo.png" alt="REDTEAM.GUIDE" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">REDTEAM.GUIDE</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/guides">Red Teaming Guides</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/about_the_book">About the book</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/about_the_authors">About the Authors</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/definitions">Red Teaming Definitions</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/threatexpress" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github"></a><a href="https://threatexpress.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-top:1px">  </span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-top:1px">  </span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="REDTEAM.GUIDE" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo.png" alt="REDTEAM.GUIDE" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">REDTEAM.GUIDE</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/guides">Red Teaming Guides</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/about_the_book">About the book</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/about_the_authors">About the Authors</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/definitions">Red Teaming Definitions</a></li><li class="menu__list-item"><a href="https://github.com/threatexpress" target="_blank" rel="noopener noreferrer" class="menu__link github"></a></li><li class="menu__list-item"><a href="https://threatexpress.com" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu menu--responsive thin-scrollbar menu_cyFh" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/about_the_authors">About the Authors</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/about_the_book">About the Book</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/definitions">Definitions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/guides">Red Team Guides</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/references_templates_talks">References, Templates, and Presentations</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Checklists and Planning</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/checklists/red-team-checklist">Red team checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/checklists/roe-planning">Rules of Engagement (ROE) Planning</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Concepts/mitre_attack">Red Teaming and MITRE ATT&amp;CK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Concepts/red-teaming">What is Red Teaming?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Concepts/red-vs-pen-vs-vuln">Red Team Engagement vs Penetration Test vs Vulnerability Assessment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Concepts/role-relationships">Roles and Relationships</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Planning</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Planning/goal-planning">Red Team Engagement Goal Planning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Planning/red-team-tradecraft">Red Team Tradecraft and TTP Guidance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Templates</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Templates/oplog">Operator Log</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Templates/report_template">Red Team Report Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Templates/roe_template">ROE Template</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Threat Profiles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Threat Profiles/autobank">Threat Profile - AUTOBANK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Threat Profiles/blueheart">Threat Profile - BLUEHEART</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Threat Profiles/cybersnake">Threat Profile: CYBERSNAKE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/Threat Profiles/simplesam">Threat Profile: SIMPLESAM</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Exercises</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Exercises/mindset-challege">Adversarial Mindset Challenge</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/Exercises/threat-profile">Decomposing a Threat</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="markdown"><header><h1 class="h1Heading_dC7a">Decomposing a Threat</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="description"></a>Description<a class="hash-link" href="#description" title="Direct link to heading">#</a></h2><p>This is a group exercise. As a class, we will examine the Energetic Bear threat actor to build a threat profile that can be used during a Red Team engagement</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="objectives"></a>Objectives<a class="hash-link" href="#objectives" title="Direct link to heading">#</a></h2><ul><li>Review the Energetic Bear threat actor’s TTPs.</li><li>Use the information to create a threat that is similar and can be used to support future Red Team engagements.</li><li>Complete a threat profile</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="instructions"></a>Instructions<a class="hash-link" href="#instructions" title="Direct link to heading">#</a></h2><ul><li>Use the Energetic Bear material provided for reference.</li><li>Modify and adjust the profile to fit your scenario.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This is one of the more difficult exercises to complete. It is not technically difficult, but dives into threat emulation design that many have not explored. There is no right or wrong answer. The exploration and process of decomposing a threat is the most valuable aspect of the exercise. Practice is the best way to understand this process.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="scenario"></a>Scenario<a class="hash-link" href="#scenario" title="Direct link to heading">#</a></h2><p>A client has asked your Red Team to emulate a specific threat. Specifically they are interested in the attacks by Energetic Bear.</p><p><strong>Goal</strong></p><p>As professional Red Team, you understand that emulating a specific threat actor is not easy or feasible. Instead of redesigning Energetic Bear, you understand focus should be on the emulation of a threat’s TTPs. This is more valuable that emulating a specific threat actor. The goal is not document the Energetic Bear threat actor but to create a threat profile document using Energetic Bear as inspiration. You will use research on Energetic Bear&#x27;s TTPs to build out a custom threat profile that is technically feasible and can be used to engage the target with realistic threat TTPs. A complete threat profile will contain details that can be used to plan and design the execution of a threat against a target. These are typically deployed as a command and control channel. We will discuss command and control in more detail later. </p><p>Use Energetic Bear references, MITRE, ATT&amp;CK, personal experience, and intuition to develop the profile. Remember, this is your interpretation of a threat using a specific threat actor as inspiration.</p><p><strong>Resources</strong></p><ul><li><a href="https://attack.mitre.org/wiki/Main_Page" target="_blank" rel="noopener noreferrer">MITRE ATT&amp;CK Framework</a>, <a href="https://attack.mitre.org/wiki/Main_Page" target="_blank" rel="noopener noreferrer">https://attack.mitre.org/wiki/Main_Page</a></li><li><a href="https://attack.mitre.org/wiki/ATT%26CK_Navigator" target="_blank" rel="noopener noreferrer">MITRE ATT&amp;CK Navigator</a>, <a href="https://attack.mitre.org/wiki/ATT%26CK_Navigator" target="_blank" rel="noopener noreferrer">https://attack.mitre.org/wiki/ATT%26CK_Navigator</a></li><li><a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">Dragonfly: Cyberespionage Attacks Against Energy Suppliers</a>, <a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf</a></li><li><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">Energetic Bear – Crouching Yeti</a>, <a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf</a></li><li><a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">The Alley of Compromise</a>, <a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="threat-profile-example"></a>Threat Profile Example<a class="hash-link" href="#threat-profile-example" title="Direct link to heading">#</a></h3><table><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>Description</td><td>General mid-tiered threat that uses common offensive tools and techniques.</td></tr><tr><td>Goal and Intent</td><td>Exist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks.</td></tr><tr><td>Key IOCs</td><td>Cobalt Strike HTTPS beacon on TCP 443, Payload: c:\programdata\microsoft\iexplore.exe, Timestamp: 7/13/2009 10:04 PM, MD5: a7705501c5e216b56cf49dcf540184d0</td></tr><tr><td>C2 Overview</td><td>HTTPS on port 443 Cobalt Strike Beacon with a five-minute callback time. Calling directly to threat-owned domains.</td></tr><tr><td>TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)</td><td>Assumed Breach Model, no initial delivery via exploitation. POST-exploitation via Cobalt Strike commands. Enumeration and lateral movement via Cobalt Strike and native Windows commands. Privilege escalation limited and determined POST-exploitation.</td></tr><tr><td>Exploitation</td><td>Assumed Breach Model, no exploitation.</td></tr><tr><td>Persistence</td><td>User-level persistence using Microsoft Outlook rule triggered by specific email.</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="threat-profile-usage"></a>Threat Profile Usage<a class="hash-link" href="#threat-profile-usage" title="Direct link to heading">#</a></h3><p>Threat profiles typically support the engagement story and are used to describe the technical aspects of a single C2 channel. A single threat profile is used for each C2 channel.</p><p><img src="/assets/images/threatprofilediagram-34a718ef9d484fc26d523b509f119bd0.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="highlights-from-energetic-bear-threat-actor"></a>Highlights from Energetic Bear Threat Actor<a class="hash-link" href="#highlights-from-energetic-bear-threat-actor" title="Direct link to heading">#</a></h3><ul><li>Starting in 2010 and ending in 2014, Energetic Bear / Dragonfly / Crouching Yeti malware attacked numerous computers to collect information on industrial control systems in the United States and Europe</li><li>Spread out over time and thus difficult to detect</li><li>The primary goal was to collect information that impacted the energy and pharmaceutical industries</li><li>Possibly nation-state supported</li><li>Phishing, watering hole attacks</li><li>Known exploits were used (PDF, Java, IE, Word)</li><li>Compromised ICS web servers</li><li>HTTP-based C2</li><li>Specific activities and capabilities</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="iocs-from-the-actor-energetic-bear-and-the-havex-malware"></a>IOCs from the actor Energetic Bear and the HAVEX malware<a class="hash-link" href="#iocs-from-the-actor-energetic-bear-and-the-havex-malware" title="Direct link to heading">#</a></h3><p><img src="/assets/images/threatprofile_0-c076648a9d54cbfc77ee6b3a848fd422.png"></p><p><strong>Actor</strong></p><ul><li>Associated with the Russian Federation</li><li>Active over multiple years</li><li>Active primarily during Moscow business hours</li><li>Targeted organizations based in the industry control system sector</li><li>Goal of gathering intelligence on ICS-based organizations</li><li>Use of custom malware</li></ul><p><strong>Attack and delivery TTPs</strong></p><ul><li>Phishing</li><li>Watering hole</li><li>Compromised web servers</li></ul><p><strong>Exploitation TTPs</strong></p><ul><li>PDF exploits</li><li>Java and IE exploits</li><li>Word exploits</li><li>Custom binaries</li></ul><p><strong>Post-exploitation TTPs</strong></p><ul><li>Local system enumeration for OS, username, processes, internet history, etc.</li><li>Scan for known ICS-related ports</li><li>DLL injection to migrate into explorer.exe</li><li>Collect Outlook address book information</li><li>Collect passwords from browsers</li><li>Save exfiltrated data to an encrypted file on disk before delivery to the C2 in an HTTP POST request</li></ul><p><strong>Persistence TTPs</strong></p><p>Run key registry modifications:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#ffffff;background-color:#033b3f"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\&quot;TmProvider&quot;</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\&quot;TmProvider&quot;</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_LOCAL_MACHINE\ SOFTWARE\Microsoft\Internet Explorer\InternetRegistry\&quot;fertger&quot;</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\InternetRegistry</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>HAVEX Paylod Delivery</strong></p><p><img src="/assets/images/threatprofile_1-167417e8911b9d986bc96005e9cfe0a2.png"></p><p>Energetic Bear used three major methods to deliver malware.</p><p><strong>1) Malicious PDF via spear-phishing</strong>
Spear-phishing was used to infect targeted individuals for initial information gathering by delivering malicious PDF documents—in this case, PDF/SWF exploits targeting CVE-2011-0611 to drop malware.3 Even with this running through 2014, older exploits were still valuable.</p><p><strong>2) Malicious JAR and HTML via a watering hole attack</strong>
Watering hole attacks were used to deliver Backdoor.Oldrea by Symantec. These attacks exploited CVE-2013-2465, CVE-2013-1347, and CVE-2012-1723 in Java 6, Java 7, IE 7, and IE 8 to drop the HAVEX malware. The exploits appeared to be modified Metasploit Java exploits built to deliver the HAVEX loader.</p><p><strong>3) Legitimate software loaders</strong>
Energetic Bear compromised several legitimate ICS vendor websites. Binaries such as camera drivers and PLC management software were modified and made to deliver the HAVEX malware.</p><p>In order to complete the third attack type, the threat actor had to compromise several ICS vendors&#x27; websites. Sometimes called a Strategic Web Compromise (SWC) attack, these have become a favorite attack method from Russian- and Chinese-based threats. In this case, SWC attacks were used to compromise a site that would most likely be visited by customers or users of ICS systems. This made the watering hole or binary compromises much more useful against the targeted victim. Using these three attack types demonstrated an organized and arguably sophisticated threat actor. The team behind this planned and organized a scenario to be successful against its target audience.</p><p>Once malware was delivered, three major tasks were observed:</p><ul><li>System enumeration tools collected information, such as the OS version, machine name and username, and file and directory listings.</li><li>A credential-harvesting tool extracted stored passwords from various web browsers.</li><li>Secondary implants6 communicated with different C2 infrastructures using custom protocols and payloads executed in memory.</li></ul><p><strong>References</strong></p><ul><li><a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">Dragonfly: Cyberespionage Attacks Against Energy Suppliers</a>, <a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf" target="_blank" rel="noopener noreferrer">http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/Dragonfly_Threat_Against_Western_Energy_Suppliers.pdf</a></li><li><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">Energetic Bear - Crouching Yeti</a>, <a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf" target="_blank" rel="noopener noreferrer">https://media.kasperskycontenthub.com/wp-content/uploads/sites/58/2018/03/09092926/EB-YetiJuly2014-Public.pdf</a></li><li>[The Alley of Compromise](<a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise</a>, <a href="https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/blog/cve-2014-1761-alley-compromise</a>)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="havex-http-request-sample"></a>HAVEX HTTP Request Sample<a class="hash-link" href="#havex-http-request-sample" title="Direct link to heading">#</a></h3><p><strong>POST Request</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#ffffff;background-color:#033b3f"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#ffffff"><span class="token plain">POST /wp08/wp-includes/dtcla.php?id=285745296322896178920098FD80-20&amp;v1=038&amp;v2=170393861&amp;q=5265882854508EFCF958F979E4 HTTP/1.1</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/525.19(KHTML, like Gecko) Chrome/1.0.154.36 Safari/525.19</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Host: toons.freesexycomics.com</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Content-Length: 0</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-cache</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>POST Response</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#ffffff;background-color:#033b3f"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#ffffff"><span class="token plain">HTTP/1.1 200 OK</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Date: Wed, 22 Jan 2014 13:40:48 GMT</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Content-Type: text/html</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Transfer-Encoding: chunked</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Connection: keep-alive</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Server: Apache/1.3.37 (Unix)</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-cache</span></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">9f65</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">&lt;html&gt;&lt;head&gt;&lt;mega http-equiv=’CACHE-CONTROL’ content=’NO-CACHE’&gt;&lt;/head&gt;&lt;body&gt;No data!&lt;!--havexQlpoOTFBWSZTWWYvDI0BOsD/////////////////////////////////////////////4oB+93VVXu69DuN7XYzds9yt49Ques</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">[...TRUNCATED ...]</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">+yUW3zfTxWAOstsCwCckdW5 AH5Q6vbbCu7GputPt5CSfgPCAKXcAOOICMsqliACGYEhAQT3v9eD</span></span><span class="token-line" style="color:#ffffff"><span class="token plain">M92D/8XckU4UJBmLwyNA==havex--&gt;&lt;/body&gt;&lt;/head&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this example from Symantec, several indicators can be identified.</p><p>The POST request shows several indicators that may be incorporated into an emulated threat:</p><ul><li>A target PHP file (dtcla.php)</li><li>Interesting URL parameters (id, v1, v2, q)</li><li>A potentially interesting User-Agent</li><li>A target host</li></ul><p>Like the request, the response has several indicators:</p><ul><li>A server header</li><li>A potentially unique ID (9f65)</li><li>Base64-encoded data stored between text (havex &lt; base64 &gt; havex)</li></ul><p>Note: MALWAREMUSTDIE2 posted a great write-up on the HAVEX malware. This provides additional examples of C2 source code and HTTP request/response pairs.</p><p>References</p><ol><li><a href="http://pastebin.com/qCdMwtZ6" target="_blank" rel="noopener noreferrer">MALWAREMUSTDIE</a>, <a href="http://pastebin.com/qCdMwtZ6" target="_blank" rel="noopener noreferrer">http://pastebin.com/qCdMwtZ6</a></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="threat-profile-template"></a>Threat Profile Template<a class="hash-link" href="#threat-profile-template" title="Direct link to heading">#</a></h3><table><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>Description</td><td></td></tr><tr><td>Goal and Intent</td><td></td></tr><tr><td>Key IOCs</td><td></td></tr><tr><td>C2 Overview</td><td></td></tr><tr><td>TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)</td><td></td></tr><tr><td>Exploitation</td><td></td></tr><tr><td>Persistence</td><td></td></tr></tbody></table><hr><p><strong>!! Stop Here !!</strong></p><p>Do not continue until ready for a possible solution.</p><br><br><br><br><br><br><br><br><br><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="possible-solution"></a>Possible Solution<a class="hash-link" href="#possible-solution" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="threat-profile-example-1"></a>Threat Profile Example<a class="hash-link" href="#threat-profile-example-1" title="Direct link to heading">#</a></h3><table><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>Description</td><td>General mid-tiered threat that uses common offensive tools and techniques.</td></tr><tr><td>Goal and Intent</td><td>Exist in the network to enumerate systems and information in order to maintain Command and Control to support future attacks.</td></tr><tr><td>Key IOCs</td><td>PowerShell Empire HTTP agent on TCP 80, Location: Memory Resident and PowerShell Script stored in Registry, HTTP matching HAVEX</td></tr><tr><td>C2 Overview</td><td>HTTPS on port 80 with a 5 second callback. Calling directly to threat-owned domains.</td></tr><tr><td>TTPs (Enumeration, Delivery, Lateral Movement, Privilege Escalation, etc.)</td><td>Initially delivered during exploitation.  POST exploitation delivery via PowerShell commands.  Enumeration and lateral movement via PS Empire and native Windows commands.  Privilege escalation limited and determined POST exploitation.</td></tr><tr><td>Exploitation</td><td>Social Engineering via Phishing, watering hole, and supply chain via compromised web servers</td></tr><tr><td>Persistence</td><td>Persistence via registry RUN key modification</td></tr></tbody></table><p><strong>HAVEX HTTP Indicators</strong></p><p>Parameters:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#ffffff;background-color:#033b3f"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#ffffff"><span class="token plain">v1=038&amp;v2=170393861&amp;q=5265…</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Headers:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#ffffff;background-color:#033b3f"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#ffffff"><span class="token plain">&lt;head&gt;&lt;mega http-equiv=&#x27;CACHE-CONTROL&#x27; content=&#x27;NO CACHE&#x27;&gt;&lt;/head&gt;&lt;body&gt;No Data!&lt;!--havexhavex--&gt;&lt;/body&gt;&lt;/head&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>In this exercise, you examined the Energetic Bear threat actor in order to design what a threat profile can be.</p><ul><li>You learned which IOCs are exposed when tools are kept to their default settings.</li><li>You learned that the testing of tools before use is critical in understanding a tool’s IOC profile.</li><li>You changed the default IOCs of common security tools.</li><li>You learned that some tools are easier than others to modify.</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Exercises/mindset-challege"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Adversarial Mindset Challenge</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link">Description</a></li><li><a href="#objectives" class="table-of-contents__link">Objectives</a></li><li><a href="#instructions" class="table-of-contents__link">Instructions</a></li><li><a href="#scenario" class="table-of-contents__link">Scenario</a><ul><li><a href="#threat-profile-example" class="table-of-contents__link">Threat Profile Example</a></li><li><a href="#threat-profile-usage" class="table-of-contents__link">Threat Profile Usage</a></li><li><a href="#highlights-from-energetic-bear-threat-actor" class="table-of-contents__link">Highlights from Energetic Bear Threat Actor</a></li><li><a href="#iocs-from-the-actor-energetic-bear-and-the-havex-malware" class="table-of-contents__link">IOCs from the actor Energetic Bear and the HAVEX malware</a></li><li><a href="#havex-http-request-sample" class="table-of-contents__link">HAVEX HTTP Request Sample</a></li><li><a href="#threat-profile-template" class="table-of-contents__link">Threat Profile Template</a></li></ul></li><li><a href="#possible-solution" class="table-of-contents__link">Possible Solution</a><ul><li><a href="#threat-profile-example-1" class="table-of-contents__link">Threat Profile Example</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/guides">Red Team Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/about_the_book">About the Book</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/about_the_authors">About the Authors</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/definitions">Red Teaming Definitions</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/joevest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter - Joe Vest</a></li><li class="footer__item"><a href="https://twitter.com/minis_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter - James Tubberville</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://threatexpress.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/threatexpress" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 RedTeam.Guide</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a40e027e.js"></script>
<script src="/assets/js/main.b4d48a07.js"></script>
</body>
</html>